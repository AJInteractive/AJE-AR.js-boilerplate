{"version":3,"sources":["webpack:///webpack/bootstrap feee2e3e15fbc9cca6ba","webpack:///./src/app.js","webpack:///./src/lib/canvasToImage.js","webpack:///./node_modules/webrtc-adapter/out/adapter.js","webpack:///(webpack)/buildin/global.js"],"names":["require","videoSelect","document","querySelector","selectors","renderer","THREE","WebGLRenderer","antialias","alpha","setClearColor","Color","setSize","domElement","style","position","top","left","body","appendChild","onRenderFcts","scene","Scene","camera","Camera","add","arToolkitSource","THREEx","ArToolkitSource","sourceType","init","onReady","onResize","getElementById","addEventListener","takeScreenshot","window","initial","src","imgTexture","ImageUtils","loadTexture","imgMaterial","MeshBasicMaterial","map","mesh","material","arToolkitContext","ArToolkitContext","cameraParametersUrl","detectionMode","onCompleted","projectionMatrix","copy","getProjectionMatrix","push","ready","update","visible","markerControls","ArMarkerControls","type","patternUrl","changeMatrixMode","geometry","PlaneGeometry","Mesh","y","x","rotation","Math","PI","render","lastTimeMsec","requestAnimationFrame","animate","nowMsec","deltaMsec","min","forEach","onRenderFct","w","open","title","img","Image","secondImg","doubleImageCanvas","setAttribute","innerWidth","innerHeight","context","getContext","sources","firstImage","toDataURL","secondImage","arController","canvas","loadImages","images","drawImage","saveAsJPEG","callback","loadedImages","numImages","onload","copySizeTo","getDevices","deviceInfos","values","select","value","firstChild","removeChild","i","length","deviceInfo","option","createElement","deviceId","kind","text","label","selectorIndex","Array","prototype","slice","call","childNodes","some","n","navigator","mediaDevices","enumerateDevices","then","catch","handleError","getStream","stream","srcObject","start","getTracks","track","stop","videoSource","constraints","video","exact","undefined","getUserMedia","onchange","error","console","log","module","exports","$support","ctx","imageData","getImageData","dataURL","btoa","downloadMime","scaleCanvas","width","height","h","retCanvas","retCtx","getDataURL","saveFile","strData","location","href","genImage","fixType","toLowerCase","replace","r","match","encodeData","data","str","String","fromCharCode","makeURI","genBitmapImage","oData","biWidth","biHeight","biSizeImage","bfSize","BITMAPFILEHEADER","BITMAPINFOHEADER","iPadding","aImgData","strPixelData","biWidth4","iOffsetY","strPixelRow","iOffsetX","c","strEncoded","concat","saveAsImage","test","convertToImage","saveAsPNG","saveAsGIF","saveAsBMP","convertToPNG","convertToJPEG","convertToGIF","convertToBMP","f","define","g","global","self","adapter","e","t","s","o","u","a","Error","code","l","SDPUtils","writeMediaSection","transceiver","caps","dtlsRole","sdp","writeRtpDescription","writeIceParameters","iceGatherer","getLocalParameters","writeDtlsParameters","dtlsTransport","mid","direction","rtpSender","rtpReceiver","msid","id","sendEncodingParameters","ssrc","rtx","localCName","filterIceServers","iceServers","edgeVersion","hasTurn","JSON","parse","stringify","filter","server","urls","url","warn","isString","validTurn","indexOf","getCommonCapabilities","localCapabilities","remoteCapabilities","commonCapabilities","codecs","headerExtensions","fecMechanisms","findCodecByPayloadType","pt","parseInt","payloadType","preferredPayloadType","rtxCapabilityMatches","lRtx","rRtx","lCodecs","rCodecs","lCodec","parameters","apt","rCodec","name","clockRate","numChannels","rtcpFeedback","fb","j","parameter","lHeaderExtension","rHeaderExtension","uri","isActionAllowedInSignalingState","action","signalingState","offer","setLocalDescription","setRemoteDescription","answer","maybeAddCandidate","iceTransport","candidate","alreadyAdded","getRemoteCandidates","find","remoteCandidate","foundation","ip","port","priority","protocol","addRemoteCandidate","RTCPeerConnection","config","_eventTarget","createDocumentFragment","method","bind","onicecandidate","onaddstream","ontrack","onremovestream","onsignalingstatechange","oniceconnectionstatechange","onicegatheringstatechange","onnegotiationneeded","ondatachannel","canTrickleIceCandidates","needNegotiation","localStreams","remoteStreams","localDescription","remoteDescription","iceConnectionState","iceGatheringState","usingBundle","bundlePolicy","rtcpMuxPolicy","iceTransportPolicy","_iceGatherers","iceCandidatePoolSize","RTCIceGatherer","gatherPolicy","_config","transceivers","_sdpSessionId","generateSessionId","_sdpSessionVersion","_dtlsRole","_emitGatheringStateChange","event","Event","dispatchEvent","getConfiguration","getLocalStreams","getRemoteStreams","_createTransceiver","hasBundleTransport","recvEncodingParameters","wantReceive","transports","_createIceAndDtlsTransports","addTrack","_maybeFireNegotiationNeeded","RTCRtpSender","addStream","clonedStream","clone","idx","clonedTrack","enabled","removeStream","splice","getSenders","getReceivers","_createIceGatherer","sdpMLineIndex","shift","Object","defineProperty","writable","candidates","bufferCandidates","end","keys","state","_gather","onlocalcandidate","removeEventListener","evt","sdpMid","cand","component","writeCandidate","sections","splitSections","join","complete","every","setTimeout","RTCIceTransport","onicestatechange","_updateConnectionState","RTCDtlsTransport","ondtlsstatechange","onerror","_disposeIceAndDtlsTransports","_transceive","send","recv","params","encodings","rtcp","cname","compound","rtcpParameters","p","receive","description","args","arguments","Promise","resolve","reject","apply","sessionpart","mediaSection","parseRtpParameters","isIceLite","matchPrefix","rejected","isRejected","isDatachannel","remoteIceParameters","getIceParameters","remoteDtlsParameters","getDtlsParameters","role","_updateSignalingState","TypeError","cb","streams","receiverList","iceOptions","substr","split","lines","splitLines","getKind","getDirection","remoteMsid","parseMsid","getMid","generateIdentifier","parseRtpEncodingParameters","parseRtcpParameters","isComplete","cands","parseCandidate","setTransport","setRemoteCandidates","RTCRtpReceiver","getCapabilities","codec","isNewTrack","MediaStream","get","default","sid","item","receiver","trackEvent","close","newState","states","closed","connecting","checking","connected","completed","disconnected","failed","new","createOffer","offerOptions","numAudioTracks","numVideoTracks","mandatory","optional","offerToReceiveAudio","offerToReceiveVideo","writeSessionBoilerplate","getLocalCandidates","desc","RTCSessionDescription","createAnswer","mediaSectionsInOffer","localTrack","getAudioTracks","getVideoTracks","hasRtx","reducedSize","addIceCandidate","err","candidateString","trim","getStats","promises","fixStatsType","stat","inboundrtp","outboundrtp","candidatepair","localcandidate","remotecandidate","results","Map","all","res","result","set","random","toString","blob","line","parts","part","index","prefix","substring","relatedAddress","relatedPort","tcpType","ufrag","usernameFragment","toUpperCase","parseIceOptions","parseRtpMap","parsed","writeRtpMap","parseExtmap","writeExtmap","headerExtension","preferredId","parseFmtp","kv","writeFmtp","param","parseRtcpFb","writeRtcpFb","parseSsrcMedia","sp","colon","attribute","parseFingerprint","algorithm","fingerprints","setupType","fp","iceParameters","password","mline","rtpmapline","fmtps","maxptime","extension","encodingParameters","hasRed","hasUlpfec","ssrcs","primarySsrc","secondarySsrc","flows","encParam","codecPayloadType","fec","mechanism","bandwidth","maxBitrate","remoteSsrc","obj","rsize","mux","spec","planB","sessId","sessVer","sessionId","version","parseMLine","fmt","adapterFactory","utils","dependencies","opts","options","shimChrome","shimFirefox","shimEdge","shimSafari","key","hasOwnProperty","logging","browserDetails","detectBrowser","extractVersion","disableLog","disableWarnings","chromeShim","edgeShim","firefoxShim","safariShim","commonShim","browser","shimPeerConnection","browserShim","shimCreateObjectURL","shimGetUserMedia","shimMediaStream","shimSourceObject","shimOnTrack","shimAddTrackRemoveTrack","shimGetSendersWithDtmf","shimRTCIceCandidate","shimReplaceTrack","shimRTCIceServerUrls","shimCallbacksAPI","shimLocalStreamsAPI","shimRemoteStreamsAPI","shimTrackEventTransceiver","shimCreateOfferLegacy","webkitMediaStream","_ontrack","origSetRemoteDescription","pc","_ontrackpoly","te","shimSenderWithDtmf","dtmf","_dtmf","createDTMFSender","_pc","_senders","origAddTrack","sender","origRemoveTrack","removeTrack","origAddStream","origRemoveStream","origGetSenders","senders","URL","HTMLMediaElement","_srcObject","revokeObjectURL","createObjectURL","origGetLocalStreams","nativeStreams","_reverseStreams","_streams","alreadyExists","DOMException","newStream","oldStream","replaceInternalStreamId","internalId","externalStream","internalStream","RegExp","replaceExternalStreamId","nativeMethod","isLegacyCall","origSetLocalDescription","origLocalDescription","getOwnPropertyDescriptor","isLocal","streamid","hasTrack","pcConfig","pcConstraints","iceTransports","webkitRTCPeerConnection","generateCertificate","OrigPeerConnection","newIceServers","deprecated","origGetStats","selector","successCallback","errorCallback","fixChromeStats_","response","standardReport","reports","report","standardStats","timestamp","names","makeMapStats","stats","successCallbackWrapper_","promise","RTCIceCandidate","nativeAddIceCandidate","constraintsToChrome_","cc","ideal","max","oldname_","charAt","oc","mix","advanced","shimConstraints_","func","audio","remap","b","face","facingMode","getSupportedFacingModeLies","getSupportedConstraints","matches","devices","d","dev","shimError_","PermissionDeniedError","InvalidStateError","DevicesNotFoundError","ConstraintNotSatisfiedError","TrackStartError","MediaDeviceFailedDueToShutdown","MediaDeviceKillSwitchOn","message","constraint","constraintName","getUserMedia_","onSuccess","onError","webkitGetUserMedia","getUserMediaPromise_","kinds","MediaStreamTrack","getSources","device","groupId","echoCancellation","frameRate","origGetUserMedia","cs","wrapPeerConnectionEvent","eventNameToWrap","wrapper","proto","nativeAddEventListener","nativeEventName","wrappedCallback","_eventMap","nativeRemoveEventListener","unwrappedCb","NativeRTCIceCandidate","nativeCandidate","parsedCandidate","augmentedCandidate","assign","toJSON","nativeCreateObjectURL","nativeRevokeObjectURL","newId","delete","dsc","nativeSetAttribute","shimRTCPeerConnection","origMSTEnabled","ev","RTCDtmfSender","replaceTrack","setTrack","RTCTrackEvent","mozSrcObject","mozRTCPeerConnection","newServer","username","credential","mozRTCSessionDescription","mozRTCIceCandidate","modernStatsTypes","nativeGetStats","onSucc","onErr","InternalError","NotSupportedError","SecurityError","constraintsToFF37_","mozGetUserMedia","infos","orgEnumerateDevices","nativeGetUserMedia","getSettings","nativeGetSettings","applyConstraints","nativeApplyConstraints","_localStreams","getStreamById","_remoteStreams","_addTrack","tracks","_onaddstream","_onaddstreampoly","failureCallback","withCallback","errcb","RTCTransceiver","origCreateOffer","audioTransceiver","getTransceivers","setDirection","addTransceiver","videoTransceiver","logDisabled_","deprecationWarnings_","bool","oldMethod","newMethod","uastring","expr","pos","userAgent","Function","eval"],"mappings":"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","file":"app.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap feee2e3e15fbc9cca6ba","import canvasToImage from \"./lib/canvasToImage.js\";\nrequire(\"../node_modules/webrtc-adapter/out/adapter.js\");\n\nvar videoSelect = document.querySelector(\"select#videoSource\");\nvar selectors = [videoSelect];\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tInit\n//////////////////////////////////////////////////////////////////////////////////\n\n// init renderer\nvar renderer = new THREE.WebGLRenderer({\n  antialias: true,\n  alpha: true\n});\n\nrenderer.setClearColor(new THREE.Color(\"lightgrey\"), 0);\nrenderer.setSize(640, 480);\nrenderer.domElement.style.position = \"absolute\";\nrenderer.domElement.style.top = \"0px\";\nrenderer.domElement.style.left = \"0px\";\ndocument.body.appendChild(renderer.domElement);\n\n// array of functions for the rendering loop\nvar onRenderFcts = [];\n\n// init scene and camera\nvar scene = new THREE.Scene();\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tInitialize a basic camera\n//////////////////////////////////////////////////////////////////////////////////\n\n// Create a camera\nvar camera = new THREE.Camera();\nscene.add(camera);\n\n////////////////////////////////////////////////////////////////////////////////\n//          handle arToolkitSource\n////////////////////////////////////////////////////////////////////////////////\n\nvar arToolkitSource = new THREEx.ArToolkitSource({\n  // to read from the webcam\n  sourceType: \"webcam\"\n\n  // to read from an image\n  // sourceType : 'image',\n  // sourceUrl : './images/old-aja.jpg',\n\n  // to read from a video\n  // sourceType : 'video',\n  // sourceUrl : '',\n});\n\n// =============================================================================\n// UI EVENTS\n// =============================================================================\n\n// initlial resise of the canvas\narToolkitSource.init(function onReady() {\n  onResize();\n});\n\n// on button click take screen shot\ndocument.getElementById(\"snapshot\").addEventListener(\"click\", takeScreenshot);\n\n// handle resize\nwindow.addEventListener(\"resize\", function() {\n  onResize();\n});\n\nvar initial = 1;\ndocument.getElementById(\"img-thumb\").addEventListener(\"click\", function() {\n  // for updating the mesh material to change the image\n  document.getElementById(\"img-thumb\").src =\n    \"images/old-aj\" + [\"e\", \"a\"][initial] + \".jpg\";\n  initial = 1 - initial;\n  var imgTexture = THREE.ImageUtils.loadTexture(\n    \"images/old-aj\" + [\"e\", \"a\"][initial] + \".jpg\"\n  );\n  var imgMaterial = new THREE.MeshBasicMaterial({ map: imgTexture });\n  mesh.material = imgMaterial;\n});\n\n////////////////////////////////////////////////////////////////////////////////\n//          initialize arToolkitContext\n////////////////////////////////////////////////////////////////////////////////\n\n// create atToolkitContext\nvar arToolkitContext = new THREEx.ArToolkitContext({\n  cameraParametersUrl:\n    \"https://cdn.rawgit.com/AJInteractive/AJE-AR.js-boilerplate/dfb16e8c/build/data/camera_para.dat\",\n  detectionMode: \"mono\"\n});\n// initialize it\narToolkitContext.init(function onCompleted() {\n  // copy projection matrix to camera\n  camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix());\n});\n\n// update artoolkit on every frame\nonRenderFcts.push(function() {\n  if (arToolkitSource.ready === false) return;\n  arToolkitContext.update(arToolkitSource.domElement);\n  // update scene.visible if the marker is seen\n  scene.visible = camera.visible;\n});\n\n////////////////////////////////////////////////////////////////////////////////\n//          Create a ArMarkerControls\n////////////////////////////////////////////////////////////////////////////////\n\n// init controls for camera\nvar markerControls = new THREEx.ArMarkerControls(arToolkitContext, camera, {\n  type: \"pattern\",\n  patternUrl:\n    \"https://cdn.rawgit.com/AJInteractive/AJE-AR.js-boilerplate/dfb16e8c/build/data/patt.jazeera\",\n  // patternUrl : './data/patt.kanji',\n  // as we controls the camera, set changeMatrixMode: 'cameraTransformMatrix'\n  changeMatrixMode: \"cameraTransformMatrix\"\n});\n// as we do changeMatrixMode: 'cameraTransformMatrix', start with invisible scene\nscene.visible = false;\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\tadd an object in the scene\n//////////////////////////////////////////////////////////////////////////////////\n\n// add a torus knot\nvar imgTexture = THREE.ImageUtils.loadTexture(\"images/old-aja.jpg\");\nvar imgMaterial = new THREE.MeshBasicMaterial({ map: imgTexture });\nvar geometry = new THREE.PlaneGeometry(5, 5);\nvar mesh = new THREE.Mesh(geometry, imgMaterial);\n\nmesh.position.y = 0;\nmesh.position.x = 0;\nscene.add(mesh);\nmesh.rotation.x = 1.5 * Math.PI;\n\n//////////////////////////////////////////////////////////////////////////////////\n//\t\trender the whole thing on the page\n//////////////////////////////////////////////////////////////////////////////////\n\n// render the scene\nonRenderFcts.push(function() {\n  renderer.render(scene, camera);\n});\n// run the rendering loop\nvar lastTimeMsec = null;\nrequestAnimationFrame(function animate(nowMsec) {\n  // keep looping\n  requestAnimationFrame(animate);\n  // measure time\n  lastTimeMsec = lastTimeMsec || nowMsec - 1000 / 60;\n  var deltaMsec = Math.min(200, nowMsec - lastTimeMsec);\n  lastTimeMsec = nowMsec;\n  // call each update function\n  onRenderFcts.forEach(function(onRenderFct) {\n    onRenderFct(deltaMsec / 1000, nowMsec / 1000);\n  });\n});\n\n// =============================================================================\n// events function\n// =============================================================================\n\nfunction takeScreenshot() {\n  var w = window.open(\"\", \"\");\n  w.document.title = \"Screenshot\";\n  var img = new Image();\n  var secondImg = new Image();\n  renderer.render(scene, camera);\n  var doubleImageCanvas = document.getElementById(\"doubleImage\");\n  doubleImageCanvas.setAttribute(\"width\", window.innerWidth);\n  doubleImageCanvas.setAttribute(\"height\", window.innerHeight);\n  var context = doubleImageCanvas.getContext(\"2d\");\n  var sources = {\n    firstImage: renderer.domElement.toDataURL(\"image/png\"),\n    secondImage: arToolkitContext.arController.canvas.toDataURL(\"image/png\")\n  };\n  loadImages(sources, function(images) {\n    context.drawImage(images.secondImage, 0, 0);\n    context.drawImage(images.firstImage, 0, 0);\n    img.src = doubleImageCanvas.toDataURL(\"image/png\");\n    img.style = \"width: auto; max-height: 100%;\";\n    w.document.body.appendChild(img);\n    canvasToImage.saveAsJPEG(doubleImageCanvas, 640, 480);\n  });\n}\n\n// helper function to load images into the dom\nfunction loadImages(sources, callback) {\n  var images = {};\n  var loadedImages = 0;\n  var numImages = 0;\n  // get num of sources\n  for (var src in sources) {\n    numImages++;\n  }\n  for (var src in sources) {\n    images[src] = new Image();\n    images[src].onload = function() {\n      if (++loadedImages >= numImages) {\n        callback(images);\n      }\n    };\n    images[src].src = sources[src];\n  }\n}\n\n// resize canvas on browser resize\nfunction onResize() {\n  arToolkitSource.onResize();\n  arToolkitSource.copySizeTo(renderer.domElement);\n  if (arToolkitContext.arController !== null) {\n    arToolkitSource.copySizeTo(arToolkitContext.arController.canvas);\n  }\n}\n\n// =============================================================================\n// adding camera selection\n// =============================================================================\nfunction getDevices(deviceInfos) {\n  var values = selectors.map(function(select) {\n    return select.value;\n  });\n  selectors.forEach(function(select) {\n    while (select.firstChild) {\n      select.removeChild(select.firstChild);\n    }\n  });\n\n  for (var i = 0; i !== deviceInfos.length; ++i) {\n    var deviceInfo = deviceInfos[i];\n    var option = document.createElement(\"option\");\n    option.value = deviceInfo.deviceId;\n    if (deviceInfo.kind === \"videoinput\") {\n      option.text = deviceInfo.label || \"camera \" + (videoSelect.length + 1);\n      videoSelect.appendChild(option);\n    }\n    selectors.forEach(function(select, selectorIndex) {\n      if (\n        Array.prototype.slice.call(select.childNodes).some(function(n) {\n          return n.value === values[selectorIndex];\n        })\n      ) {\n        select.value = values[selectorIndex];\n      }\n    });\n  }\n}\n\nnavigator.mediaDevices\n  .enumerateDevices()\n  .then(getDevices)\n  .catch(handleError);\n\nfunction getStream(stream) {\n  arToolkitSource.domElement.srcObject = stream;\n  return navigator.mediaDevices.enumerateDevices();\n}\n\nfunction start() {\n  if (window.stream) {\n    window.stream.getTracks().forEach(function(track) {\n      track.stop();\n    });\n  }\n  var videoSource = videoSelect.value;\n  var constraints = {\n    video: {\n      deviceId: videoSource ? { exact: videoSource } : undefined\n    }\n  };\n  navigator.mediaDevices\n    .getUserMedia(constraints)\n    .then(getStream)\n    .then(getDevices)\n    .catch(handleError);\n}\n\nvideoSelect.onchange = start;\n\nfunction handleError(error) {\n  console.log(\"navigator.getUserMedia error: \", error);\n}\n\nstart();\n\n\n\n// WEBPACK FOOTER //\n// ./src/app.js","\nmodule.exports = function () {\n\n\t// check if support sth.\n\tvar $support = function () {\n\t\tvar canvas = document.createElement('canvas'),\n\t\t\tctx = canvas.getContext('2d');\n\n\t\treturn {\n\t\t\tcanvas: !!ctx,\n\t\t\timageData: !!ctx.getImageData,\n\t\t\tdataURL: !!canvas.toDataURL,\n\t\t\tbtoa: !!window.btoa\n\t\t};\n\t}();\n\n\tvar downloadMime = 'image/octet-stream';\n\n\tfunction scaleCanvas (canvas, width, height) {\n\t\tvar w = canvas.width,\n\t\t\th = canvas.height;\n\t\tif (width == undefined) {\n\t\t\twidth = w;\n\t\t}\n\t\tif (height == undefined) {\n\t\t\theight = h;\n\t\t}\n\n\t\tvar retCanvas = document.createElement('canvas');\n\t\tvar retCtx = retCanvas.getContext('2d');\n\t\tretCanvas.width = width;\n\t\tretCanvas.height = height;\n\t\tretCtx.drawImage(canvas, 0, 0, w, h, 0, 0, width, height);\n\t\treturn retCanvas;\n\t}\n\n\tfunction getDataURL (canvas, type, width, height) {\n\t\tcanvas = scaleCanvas(canvas, width, height);\n\t\treturn canvas.toDataURL(type);\n\t}\n\n\tfunction saveFile (strData) {\n\t\tdocument.location.href = strData;\n\t}\n\n\tfunction genImage(strData) {\n\t\tvar img = document.createElement('img');\n\t\timg.src = strData;\n\t\treturn img;\n\t}\n\tfunction fixType (type) {\n\t\ttype = type.toLowerCase().replace(/jpg/i, 'jpeg');\n\t\tvar r = type.match(/png|jpeg|bmp|gif/)[0];\n\t\treturn 'image/' + r;\n\t}\n\tfunction encodeData (data) {\n\t\tif (!window.btoa) { throw 'btoa undefined' }\n\t\tvar str = '';\n\t\tif (typeof data == 'string') {\n\t\t\tstr = data;\n\t\t} else {\n\t\t\tfor (var i = 0; i < data.length; i ++) {\n\t\t\t\tstr += String.fromCharCode(data[i]);\n\t\t\t}\n\t\t}\n\n\t\treturn btoa(str);\n\t}\n\tfunction getImageData (canvas) {\n\t\tvar w = canvas.width,\n\t\t\th = canvas.height;\n\t\treturn canvas.getContext('2d').getImageData(0, 0, w, h);\n\t}\n\tfunction makeURI (strData, type) {\n\t\treturn 'data:' + type + ';base64,' + strData;\n\t}\n\n\n\t/**\n\t * create bitmap image\n\t * \n\t */\n\tvar genBitmapImage = function (oData) {\n\n\t\t//\n\t\t// BITMAPFILEHEADER: http://msdn.microsoft.com/en-us/library/windows/desktop/dd183374(v=vs.85).aspx\n\t\t// BITMAPINFOHEADER: http://msdn.microsoft.com/en-us/library/dd183376.aspx\n\t\t//\n\n\t\tvar biWidth  = oData.width;\n\t\tvar biHeight\t= oData.height;\n\t\tvar biSizeImage = biWidth * biHeight * 3;\n\t\tvar bfSize  = biSizeImage + 54; // total header size = 54 bytes\n\n\t\t//\n\t\t//  typedef struct tagBITMAPFILEHEADER {\n\t\t//  \tWORD bfType;\n\t\t//  \tDWORD bfSize;\n\t\t//  \tWORD bfReserved1;\n\t\t//  \tWORD bfReserved2;\n\t\t//  \tDWORD bfOffBits;\n\t\t//  } BITMAPFILEHEADER;\n\t\t//\n\t\tvar BITMAPFILEHEADER = [\n\t\t\t// WORD bfType -- The file type signature; must be \"BM\"\n\t\t\t0x42, 0x4D,\n\t\t\t// DWORD bfSize -- The size, in bytes, of the bitmap file\n\t\t\tbfSize & 0xff, bfSize >> 8 & 0xff, bfSize >> 16 & 0xff, bfSize >> 24 & 0xff,\n\t\t\t// WORD bfReserved1 -- Reserved; must be zero\n\t\t\t0, 0,\n\t\t\t// WORD bfReserved2 -- Reserved; must be zero\n\t\t\t0, 0,\n\t\t\t// DWORD bfOffBits -- The offset, in bytes, from the beginning of the BITMAPFILEHEADER structure to the bitmap bits.\n\t\t\t54, 0, 0, 0\n\t\t];\n\n\t\t//\n\t\t//  typedef struct tagBITMAPINFOHEADER {\n\t\t//  \tDWORD biSize;\n\t\t//  \tLONG  biWidth;\n\t\t//  \tLONG  biHeight;\n\t\t//  \tWORD  biPlanes;\n\t\t//  \tWORD  biBitCount;\n\t\t//  \tDWORD biCompression;\n\t\t//  \tDWORD biSizeImage;\n\t\t//  \tLONG  biXPelsPerMeter;\n\t\t//  \tLONG  biYPelsPerMeter;\n\t\t//  \tDWORD biClrUsed;\n\t\t//  \tDWORD biClrImportant;\n\t\t//  } BITMAPINFOHEADER, *PBITMAPINFOHEADER;\n\t\t//\n\t\tvar BITMAPINFOHEADER = [\n\t\t\t// DWORD biSize -- The number of bytes required by the structure\n\t\t\t40, 0, 0, 0,\n\t\t\t// LONG biWidth -- The width of the bitmap, in pixels\n\t\t\tbiWidth & 0xff, biWidth >> 8 & 0xff, biWidth >> 16 & 0xff, biWidth >> 24 & 0xff,\n\t\t\t// LONG biHeight -- The height of the bitmap, in pixels\n\t\t\tbiHeight & 0xff, biHeight >> 8  & 0xff, biHeight >> 16 & 0xff, biHeight >> 24 & 0xff,\n\t\t\t// WORD biPlanes -- The number of planes for the target device. This value must be set to 1\n\t\t\t1, 0,\n\t\t\t// WORD biBitCount -- The number of bits-per-pixel, 24 bits-per-pixel -- the bitmap\n\t\t\t// has a maximum of 2^24 colors (16777216, Truecolor)\n\t\t\t24, 0,\n\t\t\t// DWORD biCompression -- The type of compression, BI_RGB (code 0) -- uncompressed\n\t\t\t0, 0, 0, 0,\n\t\t\t// DWORD biSizeImage -- The size, in bytes, of the image. This may be set to zero for BI_RGB bitmaps\n\t\t\tbiSizeImage & 0xff, biSizeImage >> 8 & 0xff, biSizeImage >> 16 & 0xff, biSizeImage >> 24 & 0xff,\n\t\t\t// LONG biXPelsPerMeter, unused\n\t\t\t0,0,0,0,\n\t\t\t// LONG biYPelsPerMeter, unused\n\t\t\t0,0,0,0,\n\t\t\t// DWORD biClrUsed, the number of color indexes of palette, unused\n\t\t\t0,0,0,0,\n\t\t\t// DWORD biClrImportant, unused\n\t\t\t0,0,0,0\n\t\t];\n\n\t\tvar iPadding = (4 - ((biWidth * 3) % 4)) % 4;\n\n\t\tvar aImgData = oData.data;\n\n\t\tvar strPixelData = '';\n\t\tvar biWidth4 = biWidth<<2;\n\t\tvar y = biHeight;\n\t\tvar fromCharCode = String.fromCharCode;\n\n\t\tdo {\n\t\t\tvar iOffsetY = biWidth4*(y-1);\n\t\t\tvar strPixelRow = '';\n\t\t\tfor (var x = 0; x < biWidth; x++) {\n\t\t\t\tvar iOffsetX = x<<2;\n\t\t\t\tstrPixelRow += fromCharCode(aImgData[iOffsetY+iOffsetX+2]) +\n\t\t\t\t\t\t\t   fromCharCode(aImgData[iOffsetY+iOffsetX+1]) +\n\t\t\t\t\t\t\t   fromCharCode(aImgData[iOffsetY+iOffsetX]);\n\t\t\t}\n\n\t\t\tfor (var c = 0; c < iPadding; c++) {\n\t\t\t\tstrPixelRow += String.fromCharCode(0);\n\t\t\t}\n\n\t\t\tstrPixelData += strPixelRow;\n\t\t} while (--y);\n\n\t\tvar strEncoded = encodeData(BITMAPFILEHEADER.concat(BITMAPINFOHEADER)) + encodeData(strPixelData);\n\n\t\treturn strEncoded;\n\t};\n\n\t/**\n\t * saveAsImage\n\t * @param canvasElement\n\t * @param {String} image type\n\t * @param {Number} [optional] png width\n\t * @param {Number} [optional] png height\n\t */\n\tvar saveAsImage = function (canvas, width, height, type) {\n\t\tif ($support.canvas && $support.dataURL) {\n\t\t\tif (typeof canvas == \"string\") { canvas = document.getElementById(canvas); }\n\t\t\tif (type == undefined) { type = 'png'; }\n\t\t\ttype = fixType(type);\n\t\t\tif (/bmp/.test(type)) {\n\t\t\t\tvar data = getImageData(scaleCanvas(canvas, width, height));\n\t\t\t\tvar strData = genBitmapImage(data);\n\t\t\t\tsaveFile(makeURI(strData, downloadMime));\n\t\t\t} else {\n\t\t\t\tvar strData = getDataURL(canvas, type, width, height);\n\t\t\t\tsaveFile(strData.replace(type, downloadMime));\n\t\t\t}\n\t\t}\n\t};\n\n\tvar convertToImage = function (canvas, width, height, type) {\n\t\tif ($support.canvas && $support.dataURL) {\n\t\t\tif (typeof canvas == \"string\") { canvas = document.getElementById(canvas); }\n\t\t\tif (type == undefined) { type = 'png'; }\n\t\t\ttype = fixType(type);\n\n\t\t\tif (/bmp/.test(type)) {\n\t\t\t\tvar data = getImageData(scaleCanvas(canvas, width, height));\n\t\t\t\tvar strData = genBitmapImage(data);\n\t\t\t\treturn genImage(makeURI(strData, 'image/bmp'));\n\t\t\t} else {\n\t\t\t\tvar strData = getDataURL(canvas, type, width, height);\n\t\t\t\treturn genImage(strData);\n\t\t\t}\n\t\t}\n\t};\n\n\n\n\treturn {\n\t\tsaveAsImage: saveAsImage,\n\t\tsaveAsPNG: function (canvas, width, height) {\n\t\t\treturn saveAsImage(canvas, width, height, 'png');\n\t\t},\n\t\tsaveAsJPEG: function (canvas, width, height) {\n\t\t\treturn saveAsImage(canvas, width, height, 'jpeg');\n\t\t},\n\t\tsaveAsGIF: function (canvas, width, height) {\n\t\t\treturn saveAsImage(canvas, width, height, 'gif');\n\t\t},\n\t\tsaveAsBMP: function (canvas, width, height) {\n\t\t\treturn saveAsImage(canvas, width, height, 'bmp');\n\t\t},\n\n\t\tconvertToImage: convertToImage,\n\t\tconvertToPNG: function (canvas, width, height) {\n\t\t\treturn convertToImage(canvas, width, height, 'png');\n\t\t},\n\t\tconvertToJPEG: function (canvas, width, height) {\n\t\t\treturn convertToImage(canvas, width, height, 'jpeg');\n\t\t},\n\t\tconvertToGIF: function (canvas, width, height) {\n\t\t\treturn convertToImage(canvas, width, height, 'gif');\n\t\t},\n\t\tconvertToBMP: function (canvas, width, height) {\n\t\t\treturn convertToImage(canvas, width, height, 'bmp');\n\t\t}\n\t};\n\n}();\n\n\n// WEBPACK FOOTER //\n// ./src/lib/canvasToImage.js","(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.adapter = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\n\nfunction writeMediaSection(transceiver, caps, type, stream, dtlsRole) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : dtlsRole || 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n}\n\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nfunction filterIceServers(iceServers, edgeVersion) {\n  var hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(function(server) {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        console.warn('RTCIceServer.url is deprecated! Use urls instead.');\n      }\n      var isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(function(url) {\n        var validTurn = url.indexOf('turn:') === 0 &&\n            url.indexOf('transport=udp') !== -1 &&\n            url.indexOf('turn:[') === -1 &&\n            !hasTurn;\n\n        if (validTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return url.indexOf('stun:') === 0 && edgeVersion >= 14393 &&\n            url.indexOf('?transport=udp') === -1;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n    return false;\n  });\n}\n\n// Determines the intersection of local and remote capabilities.\nfunction getCommonCapabilities(localCapabilities, remoteCapabilities) {\n  var commonCapabilities = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: []\n  };\n\n  var findCodecByPayloadType = function(pt, codecs) {\n    pt = parseInt(pt, 10);\n    for (var i = 0; i < codecs.length; i++) {\n      if (codecs[i].payloadType === pt ||\n          codecs[i].preferredPayloadType === pt) {\n        return codecs[i];\n      }\n    }\n  };\n\n  var rtxCapabilityMatches = function(lRtx, rRtx, lCodecs, rCodecs) {\n    var lCodec = findCodecByPayloadType(lRtx.parameters.apt, lCodecs);\n    var rCodec = findCodecByPayloadType(rRtx.parameters.apt, rCodecs);\n    return lCodec && rCodec &&\n        lCodec.name.toLowerCase() === rCodec.name.toLowerCase();\n  };\n\n  localCapabilities.codecs.forEach(function(lCodec) {\n    for (var i = 0; i < remoteCapabilities.codecs.length; i++) {\n      var rCodec = remoteCapabilities.codecs[i];\n      if (lCodec.name.toLowerCase() === rCodec.name.toLowerCase() &&\n          lCodec.clockRate === rCodec.clockRate) {\n        if (lCodec.name.toLowerCase() === 'rtx' &&\n            lCodec.parameters && rCodec.parameters.apt) {\n          // for RTX we need to find the local rtx that has a apt\n          // which points to the same local codec as the remote one.\n          if (!rtxCapabilityMatches(lCodec, rCodec,\n              localCapabilities.codecs, remoteCapabilities.codecs)) {\n            continue;\n          }\n        }\n        rCodec = JSON.parse(JSON.stringify(rCodec)); // deepcopy\n        // number of channels is the highest common number of channels\n        rCodec.numChannels = Math.min(lCodec.numChannels,\n            rCodec.numChannels);\n        // push rCodec so we reply with offerer payload type\n        commonCapabilities.codecs.push(rCodec);\n\n        // determine common feedback mechanisms\n        rCodec.rtcpFeedback = rCodec.rtcpFeedback.filter(function(fb) {\n          for (var j = 0; j < lCodec.rtcpFeedback.length; j++) {\n            if (lCodec.rtcpFeedback[j].type === fb.type &&\n                lCodec.rtcpFeedback[j].parameter === fb.parameter) {\n              return true;\n            }\n          }\n          return false;\n        });\n        // FIXME: also need to determine .parameters\n        //  see https://github.com/openpeer/ortc/issues/569\n        break;\n      }\n    }\n  });\n\n  localCapabilities.headerExtensions.forEach(function(lHeaderExtension) {\n    for (var i = 0; i < remoteCapabilities.headerExtensions.length;\n         i++) {\n      var rHeaderExtension = remoteCapabilities.headerExtensions[i];\n      if (lHeaderExtension.uri === rHeaderExtension.uri) {\n        commonCapabilities.headerExtensions.push(rHeaderExtension);\n        break;\n      }\n    }\n  });\n\n  // FIXME: fecMechanisms\n  return commonCapabilities;\n}\n\n// is action=setLocalDescription with type allowed in signalingState\nfunction isActionAllowedInSignalingState(action, type, signalingState) {\n  return {\n    offer: {\n      setLocalDescription: ['stable', 'have-local-offer'],\n      setRemoteDescription: ['stable', 'have-remote-offer']\n    },\n    answer: {\n      setLocalDescription: ['have-remote-offer', 'have-local-pranswer'],\n      setRemoteDescription: ['have-local-offer', 'have-remote-pranswer']\n    }\n  }[type][action].indexOf(signalingState) !== -1;\n}\n\nfunction maybeAddCandidate(iceTransport, candidate) {\n  // Edge's internal representation adds some fields therefore\n  // not all field are taken into account.\n  var alreadyAdded = iceTransport.getRemoteCandidates()\n      .find(function(remoteCandidate) {\n        return candidate.foundation === remoteCandidate.foundation &&\n            candidate.ip === remoteCandidate.ip &&\n            candidate.port === remoteCandidate.port &&\n            candidate.priority === remoteCandidate.priority &&\n            candidate.protocol === remoteCandidate.protocol &&\n            candidate.type === remoteCandidate.type;\n      });\n  if (!alreadyAdded) {\n    iceTransport.addRemoteCandidate(candidate);\n  }\n  return !alreadyAdded;\n}\n\nmodule.exports = function(window, edgeVersion) {\n  var RTCPeerConnection = function(config) {\n    var self = this;\n\n    var _eventTarget = document.createDocumentFragment();\n    ['addEventListener', 'removeEventListener', 'dispatchEvent']\n        .forEach(function(method) {\n          self[method] = _eventTarget[method].bind(_eventTarget);\n        });\n\n    this.onicecandidate = null;\n    this.onaddstream = null;\n    this.ontrack = null;\n    this.onremovestream = null;\n    this.onsignalingstatechange = null;\n    this.oniceconnectionstatechange = null;\n    this.onicegatheringstatechange = null;\n    this.onnegotiationneeded = null;\n    this.ondatachannel = null;\n    this.canTrickleIceCandidates = null;\n\n    this.needNegotiation = false;\n\n    this.localStreams = [];\n    this.remoteStreams = [];\n\n    this.localDescription = null;\n    this.remoteDescription = null;\n\n    this.signalingState = 'stable';\n    this.iceConnectionState = 'new';\n    this.iceGatheringState = 'new';\n\n    config = JSON.parse(JSON.stringify(config || {}));\n\n    this.usingBundle = config.bundlePolicy === 'max-bundle';\n    if (config.rtcpMuxPolicy === 'negotiate') {\n      var e = new Error('rtcpMuxPolicy \\'negotiate\\' is not supported');\n      e.name = 'NotSupportedError';\n      throw(e);\n    } else if (!config.rtcpMuxPolicy) {\n      config.rtcpMuxPolicy = 'require';\n    }\n\n    switch (config.iceTransportPolicy) {\n      case 'all':\n      case 'relay':\n        break;\n      default:\n        config.iceTransportPolicy = 'all';\n        break;\n    }\n\n    switch (config.bundlePolicy) {\n      case 'balanced':\n      case 'max-compat':\n      case 'max-bundle':\n        break;\n      default:\n        config.bundlePolicy = 'balanced';\n        break;\n    }\n\n    config.iceServers = filterIceServers(config.iceServers || [], edgeVersion);\n\n    this._iceGatherers = [];\n    if (config.iceCandidatePoolSize) {\n      for (var i = config.iceCandidatePoolSize; i > 0; i--) {\n        this._iceGatherers = new window.RTCIceGatherer({\n          iceServers: config.iceServers,\n          gatherPolicy: config.iceTransportPolicy\n        });\n      }\n    } else {\n      config.iceCandidatePoolSize = 0;\n    }\n\n    this._config = config;\n\n    // per-track iceGathers, iceTransports, dtlsTransports, rtpSenders, ...\n    // everything that is needed to describe a SDP m-line.\n    this.transceivers = [];\n\n    this._sdpSessionId = SDPUtils.generateSessionId();\n    this._sdpSessionVersion = 0;\n\n    this._dtlsRole = undefined; // role for a=setup to use in answers.\n  };\n\n  RTCPeerConnection.prototype._emitGatheringStateChange = function() {\n    var event = new Event('icegatheringstatechange');\n    this.dispatchEvent(event);\n    if (typeof this.onicegatheringstatechange === 'function') {\n      this.onicegatheringstatechange(event);\n    }\n  };\n\n  RTCPeerConnection.prototype.getConfiguration = function() {\n    return this._config;\n  };\n\n  RTCPeerConnection.prototype.getLocalStreams = function() {\n    return this.localStreams;\n  };\n\n  RTCPeerConnection.prototype.getRemoteStreams = function() {\n    return this.remoteStreams;\n  };\n\n  // internal helper to create a transceiver object.\n  // (whih is not yet the same as the WebRTC 1.0 transceiver)\n  RTCPeerConnection.prototype._createTransceiver = function(kind) {\n    var hasBundleTransport = this.transceivers.length > 0;\n    var transceiver = {\n      track: null,\n      iceGatherer: null,\n      iceTransport: null,\n      dtlsTransport: null,\n      localCapabilities: null,\n      remoteCapabilities: null,\n      rtpSender: null,\n      rtpReceiver: null,\n      kind: kind,\n      mid: null,\n      sendEncodingParameters: null,\n      recvEncodingParameters: null,\n      stream: null,\n      wantReceive: true\n    };\n    if (this.usingBundle && hasBundleTransport) {\n      transceiver.iceTransport = this.transceivers[0].iceTransport;\n      transceiver.dtlsTransport = this.transceivers[0].dtlsTransport;\n    } else {\n      var transports = this._createIceAndDtlsTransports();\n      transceiver.iceTransport = transports.iceTransport;\n      transceiver.dtlsTransport = transports.dtlsTransport;\n    }\n    this.transceivers.push(transceiver);\n    return transceiver;\n  };\n\n  RTCPeerConnection.prototype.addTrack = function(track, stream) {\n    var transceiver;\n    for (var i = 0; i < this.transceivers.length; i++) {\n      if (!this.transceivers[i].track &&\n          this.transceivers[i].kind === track.kind) {\n        transceiver = this.transceivers[i];\n      }\n    }\n    if (!transceiver) {\n      transceiver = this._createTransceiver(track.kind);\n    }\n\n    this._maybeFireNegotiationNeeded();\n\n    if (this.localStreams.indexOf(stream) === -1) {\n      this.localStreams.push(stream);\n    }\n\n    transceiver.track = track;\n    transceiver.stream = stream;\n    transceiver.rtpSender = new window.RTCRtpSender(track,\n        transceiver.dtlsTransport);\n    return transceiver.rtpSender;\n  };\n\n  RTCPeerConnection.prototype.addStream = function(stream) {\n    var self = this;\n    if (edgeVersion >= 15025) {\n      stream.getTracks().forEach(function(track) {\n        self.addTrack(track, stream);\n      });\n    } else {\n      // Clone is necessary for local demos mostly, attaching directly\n      // to two different senders does not work (build 10547).\n      // Fixed in 15025 (or earlier)\n      var clonedStream = stream.clone();\n      stream.getTracks().forEach(function(track, idx) {\n        var clonedTrack = clonedStream.getTracks()[idx];\n        track.addEventListener('enabled', function(event) {\n          clonedTrack.enabled = event.enabled;\n        });\n      });\n      clonedStream.getTracks().forEach(function(track) {\n        self.addTrack(track, clonedStream);\n      });\n    }\n  };\n\n  RTCPeerConnection.prototype.removeStream = function(stream) {\n    var idx = this.localStreams.indexOf(stream);\n    if (idx > -1) {\n      this.localStreams.splice(idx, 1);\n      this._maybeFireNegotiationNeeded();\n    }\n  };\n\n  RTCPeerConnection.prototype.getSenders = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpSender;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpSender;\n    });\n  };\n\n  RTCPeerConnection.prototype.getReceivers = function() {\n    return this.transceivers.filter(function(transceiver) {\n      return !!transceiver.rtpReceiver;\n    })\n    .map(function(transceiver) {\n      return transceiver.rtpReceiver;\n    });\n  };\n\n\n  RTCPeerConnection.prototype._createIceGatherer = function(sdpMLineIndex,\n      usingBundle) {\n    var self = this;\n    if (usingBundle && sdpMLineIndex > 0) {\n      return this.transceivers[0].iceGatherer;\n    } else if (this._iceGatherers.length) {\n      return this._iceGatherers.shift();\n    }\n    var iceGatherer = new window.RTCIceGatherer({\n      iceServers: this._config.iceServers,\n      gatherPolicy: this._config.iceTransportPolicy\n    });\n    Object.defineProperty(iceGatherer, 'state',\n        {value: 'new', writable: true}\n    );\n\n    this.transceivers[sdpMLineIndex].candidates = [];\n    this.transceivers[sdpMLineIndex].bufferCandidates = function(event) {\n      var end = !event.candidate || Object.keys(event.candidate).length === 0;\n      // polyfill since RTCIceGatherer.state is not implemented in\n      // Edge 10547 yet.\n      iceGatherer.state = end ? 'completed' : 'gathering';\n      if (self.transceivers[sdpMLineIndex].candidates !== null) {\n        self.transceivers[sdpMLineIndex].candidates.push(event.candidate);\n      }\n    };\n    iceGatherer.addEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    return iceGatherer;\n  };\n\n  // start gathering from an RTCIceGatherer.\n  RTCPeerConnection.prototype._gather = function(mid, sdpMLineIndex) {\n    var self = this;\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer.onlocalcandidate) {\n      return;\n    }\n    var candidates = this.transceivers[sdpMLineIndex].candidates;\n    this.transceivers[sdpMLineIndex].candidates = null;\n    iceGatherer.removeEventListener('localcandidate',\n      this.transceivers[sdpMLineIndex].bufferCandidates);\n    iceGatherer.onlocalcandidate = function(evt) {\n      if (self.usingBundle && sdpMLineIndex > 0) {\n        // if we know that we use bundle we can drop candidates with\n        // dpMLineIndex > 0. If we don't do this then our state gets\n        // confused since we dispose the extra ice gatherer.\n        return;\n      }\n      var event = new Event('icecandidate');\n      event.candidate = {sdpMid: mid, sdpMLineIndex: sdpMLineIndex};\n\n      var cand = evt.candidate;\n      // Edge emits an empty object for RTCIceCandidateComplete\n      var end = !cand || Object.keys(cand).length === 0;\n      if (end) {\n        // polyfill since RTCIceGatherer.state is not implemented in\n        // Edge 10547 yet.\n        if (iceGatherer.state === 'new' || iceGatherer.state === 'gathering') {\n          iceGatherer.state = 'completed';\n        }\n      } else {\n        if (iceGatherer.state === 'new') {\n          iceGatherer.state = 'gathering';\n        }\n        // RTCIceCandidate doesn't have a component, needs to be added\n        cand.component = 1;\n        event.candidate.candidate = SDPUtils.writeCandidate(cand);\n      }\n\n      // update local description.\n      var sections = SDPUtils.splitSections(self.localDescription.sdp);\n      if (!end) {\n        sections[event.candidate.sdpMLineIndex + 1] +=\n            'a=' + event.candidate.candidate + '\\r\\n';\n      } else {\n        sections[event.candidate.sdpMLineIndex + 1] +=\n            'a=end-of-candidates\\r\\n';\n      }\n      self.localDescription.sdp = sections.join('');\n      var complete = self.transceivers.every(function(transceiver) {\n        return transceiver.iceGatherer &&\n            transceiver.iceGatherer.state === 'completed';\n      });\n\n      if (self.iceGatheringState !== 'gathering') {\n        self.iceGatheringState = 'gathering';\n        self._emitGatheringStateChange();\n      }\n\n      // Emit candidate. Also emit null candidate when all gatherers are\n      // complete.\n      if (!end) {\n        self.dispatchEvent(event);\n        if (typeof self.onicecandidate === 'function') {\n          self.onicecandidate(event);\n        }\n      }\n      if (complete) {\n        self.dispatchEvent(new Event('icecandidate'));\n        if (typeof self.onicecandidate === 'function') {\n          self.onicecandidate(new Event('icecandidate'));\n        }\n        self.iceGatheringState = 'complete';\n        self._emitGatheringStateChange();\n      }\n    };\n\n    // emit already gathered candidates.\n    window.setTimeout(function() {\n      candidates.forEach(function(candidate) {\n        var e = new Event('RTCIceGatherEvent');\n        e.candidate = candidate;\n        iceGatherer.onlocalcandidate(e);\n      });\n    }, 0);\n  };\n\n  // Create ICE transport and DTLS transport.\n  RTCPeerConnection.prototype._createIceAndDtlsTransports = function() {\n    var self = this;\n    var iceTransport = new window.RTCIceTransport(null);\n    iceTransport.onicestatechange = function() {\n      self._updateConnectionState();\n    };\n\n    var dtlsTransport = new window.RTCDtlsTransport(iceTransport);\n    dtlsTransport.ondtlsstatechange = function() {\n      self._updateConnectionState();\n    };\n    dtlsTransport.onerror = function() {\n      // onerror does not set state to failed by itself.\n      Object.defineProperty(dtlsTransport, 'state',\n          {value: 'failed', writable: true});\n      self._updateConnectionState();\n    };\n\n    return {\n      iceTransport: iceTransport,\n      dtlsTransport: dtlsTransport\n    };\n  };\n\n  // Destroy ICE gatherer, ICE transport and DTLS transport.\n  // Without triggering the callbacks.\n  RTCPeerConnection.prototype._disposeIceAndDtlsTransports = function(\n      sdpMLineIndex) {\n    var iceGatherer = this.transceivers[sdpMLineIndex].iceGatherer;\n    if (iceGatherer) {\n      delete iceGatherer.onlocalcandidate;\n      delete this.transceivers[sdpMLineIndex].iceGatherer;\n    }\n    var iceTransport = this.transceivers[sdpMLineIndex].iceTransport;\n    if (iceTransport) {\n      delete iceTransport.onicestatechange;\n      delete this.transceivers[sdpMLineIndex].iceTransport;\n    }\n    var dtlsTransport = this.transceivers[sdpMLineIndex].dtlsTransport;\n    if (dtlsTransport) {\n      delete dtlsTransport.ondtlsstatechange;\n      delete dtlsTransport.onerror;\n      delete this.transceivers[sdpMLineIndex].dtlsTransport;\n    }\n  };\n\n  // Start the RTP Sender and Receiver for a transceiver.\n  RTCPeerConnection.prototype._transceive = function(transceiver,\n      send, recv) {\n    var params = getCommonCapabilities(transceiver.localCapabilities,\n        transceiver.remoteCapabilities);\n    if (send && transceiver.rtpSender) {\n      params.encodings = transceiver.sendEncodingParameters;\n      params.rtcp = {\n        cname: SDPUtils.localCName,\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.recvEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.recvEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpSender.send(params);\n    }\n    if (recv && transceiver.rtpReceiver && params.codecs.length > 0) {\n      // remove RTX field in Edge 14942\n      if (transceiver.kind === 'video'\n          && transceiver.recvEncodingParameters\n          && edgeVersion < 15019) {\n        transceiver.recvEncodingParameters.forEach(function(p) {\n          delete p.rtx;\n        });\n      }\n      params.encodings = transceiver.recvEncodingParameters;\n      params.rtcp = {\n        cname: transceiver.rtcpParameters.cname,\n        compound: transceiver.rtcpParameters.compound\n      };\n      if (transceiver.sendEncodingParameters.length) {\n        params.rtcp.ssrc = transceiver.sendEncodingParameters[0].ssrc;\n      }\n      transceiver.rtpReceiver.receive(params);\n    }\n  };\n\n  RTCPeerConnection.prototype.setLocalDescription = function(description) {\n    var self = this;\n    var args = arguments;\n\n    if (!isActionAllowedInSignalingState('setLocalDescription',\n        description.type, this.signalingState)) {\n      return new Promise(function(resolve, reject) {\n        var e = new Error('Can not set local ' + description.type +\n            ' in state ' + self.signalingState);\n        e.name = 'InvalidStateError';\n        if (args.length > 2 && typeof args[2] === 'function') {\n          args[2].apply(null, [e]);\n        }\n        reject(e);\n      });\n    }\n\n    var sections;\n    var sessionpart;\n    if (description.type === 'offer') {\n      // VERY limited support for SDP munging. Limited to:\n      // * changing the order of codecs\n      sections = SDPUtils.splitSections(description.sdp);\n      sessionpart = sections.shift();\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var caps = SDPUtils.parseRtpParameters(mediaSection);\n        self.transceivers[sdpMLineIndex].localCapabilities = caps;\n      });\n\n      this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n        self._gather(transceiver.mid, sdpMLineIndex);\n      });\n    } else if (description.type === 'answer') {\n      sections = SDPUtils.splitSections(self.remoteDescription.sdp);\n      sessionpart = sections.shift();\n      var isIceLite = SDPUtils.matchPrefix(sessionpart,\n          'a=ice-lite').length > 0;\n      sections.forEach(function(mediaSection, sdpMLineIndex) {\n        var transceiver = self.transceivers[sdpMLineIndex];\n        var iceGatherer = transceiver.iceGatherer;\n        var iceTransport = transceiver.iceTransport;\n        var dtlsTransport = transceiver.dtlsTransport;\n        var localCapabilities = transceiver.localCapabilities;\n        var remoteCapabilities = transceiver.remoteCapabilities;\n\n        // treat bundle-only as not-rejected.\n        var rejected = SDPUtils.isRejected(mediaSection) &&\n            !SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 1;\n\n        if (!rejected && !transceiver.isDatachannel) {\n          var remoteIceParameters = SDPUtils.getIceParameters(\n              mediaSection, sessionpart);\n          var remoteDtlsParameters = SDPUtils.getDtlsParameters(\n              mediaSection, sessionpart);\n          if (isIceLite) {\n            remoteDtlsParameters.role = 'server';\n          }\n\n          if (!self.usingBundle || sdpMLineIndex === 0) {\n            self._gather(transceiver.mid, sdpMLineIndex);\n            if (iceTransport.state === 'new') {\n              iceTransport.start(iceGatherer, remoteIceParameters,\n                  isIceLite ? 'controlling' : 'controlled');\n            }\n            if (dtlsTransport.state === 'new') {\n              dtlsTransport.start(remoteDtlsParameters);\n            }\n          }\n\n          // Calculate intersection of capabilities.\n          var params = getCommonCapabilities(localCapabilities,\n              remoteCapabilities);\n\n          // Start the RTCRtpSender. The RTCRtpReceiver for this\n          // transceiver has already been started in setRemoteDescription.\n          self._transceive(transceiver,\n              params.codecs.length > 0,\n              false);\n        }\n      });\n    }\n\n    this.localDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    switch (description.type) {\n      case 'offer':\n        this._updateSignalingState('have-local-offer');\n        break;\n      case 'answer':\n        this._updateSignalingState('stable');\n        break;\n      default:\n        throw new TypeError('unsupported type \"' + description.type +\n            '\"');\n    }\n\n    // If a success callback was provided, emit ICE candidates after it\n    // has been executed. Otherwise, emit callback after the Promise is\n    // resolved.\n    var cb = arguments.length > 1 && typeof arguments[1] === 'function' &&\n        arguments[1];\n    return new Promise(function(resolve) {\n      if (cb) {\n        cb.apply(null);\n      }\n      resolve();\n    });\n  };\n\n  RTCPeerConnection.prototype.setRemoteDescription = function(description) {\n    var self = this;\n    var args = arguments;\n\n    if (!isActionAllowedInSignalingState('setRemoteDescription',\n        description.type, this.signalingState)) {\n      return new Promise(function(resolve, reject) {\n        var e = new Error('Can not set remote ' + description.type +\n            ' in state ' + self.signalingState);\n        e.name = 'InvalidStateError';\n        if (args.length > 2 && typeof args[2] === 'function') {\n          args[2].apply(null, [e]);\n        }\n        reject(e);\n      });\n    }\n\n    var streams = {};\n    this.remoteStreams.forEach(function(stream) {\n      streams[stream.id] = stream;\n    });\n    var receiverList = [];\n    var sections = SDPUtils.splitSections(description.sdp);\n    var sessionpart = sections.shift();\n    var isIceLite = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-lite').length > 0;\n    var usingBundle = SDPUtils.matchPrefix(sessionpart,\n        'a=group:BUNDLE ').length > 0;\n    this.usingBundle = usingBundle;\n    var iceOptions = SDPUtils.matchPrefix(sessionpart,\n        'a=ice-options:')[0];\n    if (iceOptions) {\n      this.canTrickleIceCandidates = iceOptions.substr(14).split(' ')\n          .indexOf('trickle') >= 0;\n    } else {\n      this.canTrickleIceCandidates = false;\n    }\n\n    sections.forEach(function(mediaSection, sdpMLineIndex) {\n      var lines = SDPUtils.splitLines(mediaSection);\n      var kind = SDPUtils.getKind(mediaSection);\n      // treat bundle-only as not-rejected.\n      var rejected = SDPUtils.isRejected(mediaSection) &&\n          !SDPUtils.matchPrefix(mediaSection, 'a=bundle-only').length === 1;\n      var protocol = lines[0].substr(2).split(' ')[2];\n\n      var direction = SDPUtils.getDirection(mediaSection, sessionpart);\n      var remoteMsid = SDPUtils.parseMsid(mediaSection);\n\n      var mid = SDPUtils.getMid(mediaSection) || SDPUtils.generateIdentifier();\n\n      // Reject datachannels which are not implemented yet.\n      if (kind === 'application' && protocol === 'DTLS/SCTP') {\n        self.transceivers[sdpMLineIndex] = {\n          mid: mid,\n          isDatachannel: true\n        };\n        return;\n      }\n\n      var transceiver;\n      var iceGatherer;\n      var iceTransport;\n      var dtlsTransport;\n      var rtpReceiver;\n      var sendEncodingParameters;\n      var recvEncodingParameters;\n      var localCapabilities;\n\n      var track;\n      // FIXME: ensure the mediaSection has rtcp-mux set.\n      var remoteCapabilities = SDPUtils.parseRtpParameters(mediaSection);\n      var remoteIceParameters;\n      var remoteDtlsParameters;\n      if (!rejected) {\n        remoteIceParameters = SDPUtils.getIceParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters = SDPUtils.getDtlsParameters(mediaSection,\n            sessionpart);\n        remoteDtlsParameters.role = 'client';\n      }\n      recvEncodingParameters =\n          SDPUtils.parseRtpEncodingParameters(mediaSection);\n\n      var rtcpParameters = SDPUtils.parseRtcpParameters(mediaSection);\n\n      var isComplete = SDPUtils.matchPrefix(mediaSection,\n          'a=end-of-candidates', sessionpart).length > 0;\n      var cands = SDPUtils.matchPrefix(mediaSection, 'a=candidate:')\n          .map(function(cand) {\n            return SDPUtils.parseCandidate(cand);\n          })\n          .filter(function(cand) {\n            return cand.component === 1;\n          });\n\n      // Check if we can use BUNDLE and dispose transports.\n      if ((description.type === 'offer' || description.type === 'answer') &&\n          !rejected && usingBundle && sdpMLineIndex > 0 &&\n          self.transceivers[sdpMLineIndex]) {\n        self._disposeIceAndDtlsTransports(sdpMLineIndex);\n        self.transceivers[sdpMLineIndex].iceGatherer =\n            self.transceivers[0].iceGatherer;\n        self.transceivers[sdpMLineIndex].iceTransport =\n            self.transceivers[0].iceTransport;\n        self.transceivers[sdpMLineIndex].dtlsTransport =\n            self.transceivers[0].dtlsTransport;\n        if (self.transceivers[sdpMLineIndex].rtpSender) {\n          self.transceivers[sdpMLineIndex].rtpSender.setTransport(\n              self.transceivers[0].dtlsTransport);\n        }\n        if (self.transceivers[sdpMLineIndex].rtpReceiver) {\n          self.transceivers[sdpMLineIndex].rtpReceiver.setTransport(\n              self.transceivers[0].dtlsTransport);\n        }\n      }\n      if (description.type === 'offer' && !rejected) {\n        transceiver = self.transceivers[sdpMLineIndex] ||\n            self._createTransceiver(kind);\n        transceiver.mid = mid;\n\n        if (!transceiver.iceGatherer) {\n          transceiver.iceGatherer = self._createIceGatherer(sdpMLineIndex,\n              usingBundle);\n        }\n\n        if (cands.length && transceiver.iceTransport.state === 'new') {\n          if (isComplete && (!usingBundle || sdpMLineIndex === 0)) {\n            transceiver.iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        localCapabilities = window.RTCRtpReceiver.getCapabilities(kind);\n\n        // filter RTX until additional stuff needed for RTX is implemented\n        // in adapter.js\n        if (edgeVersion < 15019) {\n          localCapabilities.codecs = localCapabilities.codecs.filter(\n              function(codec) {\n                return codec.name !== 'rtx';\n              });\n        }\n\n        sendEncodingParameters = transceiver.sendEncodingParameters || [{\n          ssrc: (2 * sdpMLineIndex + 2) * 1001\n        }];\n\n        var isNewTrack = false;\n        if (direction === 'sendrecv' || direction === 'sendonly') {\n          isNewTrack = !transceiver.rtpReceiver;\n          rtpReceiver = transceiver.rtpReceiver ||\n              new window.RTCRtpReceiver(transceiver.dtlsTransport, kind);\n\n          if (isNewTrack) {\n            var stream;\n            track = rtpReceiver.track;\n            // FIXME: does not work with Plan B.\n            if (remoteMsid) {\n              if (!streams[remoteMsid.stream]) {\n                streams[remoteMsid.stream] = new window.MediaStream();\n                Object.defineProperty(streams[remoteMsid.stream], 'id', {\n                  get: function() {\n                    return remoteMsid.stream;\n                  }\n                });\n              }\n              Object.defineProperty(track, 'id', {\n                get: function() {\n                  return remoteMsid.track;\n                }\n              });\n              stream = streams[remoteMsid.stream];\n            } else {\n              if (!streams.default) {\n                streams.default = new window.MediaStream();\n              }\n              stream = streams.default;\n            }\n            stream.addTrack(track);\n            receiverList.push([track, rtpReceiver, stream]);\n          }\n        }\n\n        transceiver.localCapabilities = localCapabilities;\n        transceiver.remoteCapabilities = remoteCapabilities;\n        transceiver.rtpReceiver = rtpReceiver;\n        transceiver.rtcpParameters = rtcpParameters;\n        transceiver.sendEncodingParameters = sendEncodingParameters;\n        transceiver.recvEncodingParameters = recvEncodingParameters;\n\n        // Start the RTCRtpReceiver now. The RTPSender is started in\n        // setLocalDescription.\n        self._transceive(self.transceivers[sdpMLineIndex],\n            false,\n            isNewTrack);\n      } else if (description.type === 'answer' && !rejected) {\n        transceiver = self.transceivers[sdpMLineIndex];\n        iceGatherer = transceiver.iceGatherer;\n        iceTransport = transceiver.iceTransport;\n        dtlsTransport = transceiver.dtlsTransport;\n        rtpReceiver = transceiver.rtpReceiver;\n        sendEncodingParameters = transceiver.sendEncodingParameters;\n        localCapabilities = transceiver.localCapabilities;\n\n        self.transceivers[sdpMLineIndex].recvEncodingParameters =\n            recvEncodingParameters;\n        self.transceivers[sdpMLineIndex].remoteCapabilities =\n            remoteCapabilities;\n        self.transceivers[sdpMLineIndex].rtcpParameters = rtcpParameters;\n\n        if (cands.length && iceTransport.state === 'new') {\n          if ((isIceLite || isComplete) &&\n              (!usingBundle || sdpMLineIndex === 0)) {\n            iceTransport.setRemoteCandidates(cands);\n          } else {\n            cands.forEach(function(candidate) {\n              maybeAddCandidate(transceiver.iceTransport, candidate);\n            });\n          }\n        }\n\n        if (!usingBundle || sdpMLineIndex === 0) {\n          if (iceTransport.state === 'new') {\n            iceTransport.start(iceGatherer, remoteIceParameters,\n                'controlling');\n          }\n          if (dtlsTransport.state === 'new') {\n            dtlsTransport.start(remoteDtlsParameters);\n          }\n        }\n\n        self._transceive(transceiver,\n            direction === 'sendrecv' || direction === 'recvonly',\n            direction === 'sendrecv' || direction === 'sendonly');\n\n        if (rtpReceiver &&\n            (direction === 'sendrecv' || direction === 'sendonly')) {\n          track = rtpReceiver.track;\n          if (remoteMsid) {\n            if (!streams[remoteMsid.stream]) {\n              streams[remoteMsid.stream] = new window.MediaStream();\n            }\n            streams[remoteMsid.stream].addTrack(track);\n            receiverList.push([track, rtpReceiver, streams[remoteMsid.stream]]);\n          } else {\n            if (!streams.default) {\n              streams.default = new window.MediaStream();\n            }\n            streams.default.addTrack(track);\n            receiverList.push([track, rtpReceiver, streams.default]);\n          }\n        } else {\n          // FIXME: actually the receiver should be created later.\n          delete transceiver.rtpReceiver;\n        }\n      }\n    });\n\n    if (this._dtlsRole === undefined) {\n      this._dtlsRole = description.type === 'offer' ? 'active' : 'passive';\n    }\n\n    this.remoteDescription = {\n      type: description.type,\n      sdp: description.sdp\n    };\n    switch (description.type) {\n      case 'offer':\n        this._updateSignalingState('have-remote-offer');\n        break;\n      case 'answer':\n        this._updateSignalingState('stable');\n        break;\n      default:\n        throw new TypeError('unsupported type \"' + description.type +\n            '\"');\n    }\n    Object.keys(streams).forEach(function(sid) {\n      var stream = streams[sid];\n      if (stream.getTracks().length) {\n        if (self.remoteStreams.indexOf(stream) === -1) {\n          self.remoteStreams.push(stream);\n          var event = new Event('addstream');\n          event.stream = stream;\n          window.setTimeout(function() {\n            self.dispatchEvent(event);\n            if (typeof self.onaddstream === 'function') {\n              self.onaddstream(event);\n            }\n          });\n        }\n\n        receiverList.forEach(function(item) {\n          var track = item[0];\n          var receiver = item[1];\n          if (stream.id !== item[2].id) {\n            return;\n          }\n          var trackEvent = new Event('track');\n          trackEvent.track = track;\n          trackEvent.receiver = receiver;\n          trackEvent.transceiver = {receiver: receiver};\n          trackEvent.streams = [stream];\n          window.setTimeout(function() {\n            self.dispatchEvent(trackEvent);\n            if (typeof self.ontrack === 'function') {\n              self.ontrack(trackEvent);\n            }\n          });\n        });\n      }\n    });\n\n    // check whether addIceCandidate({}) was called within four seconds after\n    // setRemoteDescription.\n    window.setTimeout(function() {\n      if (!(self && self.transceivers)) {\n        return;\n      }\n      self.transceivers.forEach(function(transceiver) {\n        if (transceiver.iceTransport &&\n            transceiver.iceTransport.state === 'new' &&\n            transceiver.iceTransport.getRemoteCandidates().length > 0) {\n          console.warn('Timeout for addRemoteCandidate. Consider sending ' +\n              'an end-of-candidates notification');\n          transceiver.iceTransport.addRemoteCandidate({});\n        }\n      });\n    }, 4000);\n\n    return new Promise(function(resolve) {\n      if (args.length > 1 && typeof args[1] === 'function') {\n        args[1].apply(null);\n      }\n      resolve();\n    });\n  };\n\n  RTCPeerConnection.prototype.close = function() {\n    this.transceivers.forEach(function(transceiver) {\n      /* not yet\n      if (transceiver.iceGatherer) {\n        transceiver.iceGatherer.close();\n      }\n      */\n      if (transceiver.iceTransport) {\n        transceiver.iceTransport.stop();\n      }\n      if (transceiver.dtlsTransport) {\n        transceiver.dtlsTransport.stop();\n      }\n      if (transceiver.rtpSender) {\n        transceiver.rtpSender.stop();\n      }\n      if (transceiver.rtpReceiver) {\n        transceiver.rtpReceiver.stop();\n      }\n    });\n    // FIXME: clean up tracks, local streams, remote streams, etc\n    this._updateSignalingState('closed');\n  };\n\n  // Update the signaling state.\n  RTCPeerConnection.prototype._updateSignalingState = function(newState) {\n    this.signalingState = newState;\n    var event = new Event('signalingstatechange');\n    this.dispatchEvent(event);\n    if (typeof this.onsignalingstatechange === 'function') {\n      this.onsignalingstatechange(event);\n    }\n  };\n\n  // Determine whether to fire the negotiationneeded event.\n  RTCPeerConnection.prototype._maybeFireNegotiationNeeded = function() {\n    var self = this;\n    if (this.signalingState !== 'stable' || this.needNegotiation === true) {\n      return;\n    }\n    this.needNegotiation = true;\n    window.setTimeout(function() {\n      if (self.needNegotiation === false) {\n        return;\n      }\n      self.needNegotiation = false;\n      var event = new Event('negotiationneeded');\n      self.dispatchEvent(event);\n      if (typeof self.onnegotiationneeded === 'function') {\n        self.onnegotiationneeded(event);\n      }\n    }, 0);\n  };\n\n  // Update the connection state.\n  RTCPeerConnection.prototype._updateConnectionState = function() {\n    var newState;\n    var states = {\n      'new': 0,\n      closed: 0,\n      connecting: 0,\n      checking: 0,\n      connected: 0,\n      completed: 0,\n      disconnected: 0,\n      failed: 0\n    };\n    this.transceivers.forEach(function(transceiver) {\n      states[transceiver.iceTransport.state]++;\n      states[transceiver.dtlsTransport.state]++;\n    });\n    // ICETransport.completed and connected are the same for this purpose.\n    states.connected += states.completed;\n\n    newState = 'new';\n    if (states.failed > 0) {\n      newState = 'failed';\n    } else if (states.connecting > 0 || states.checking > 0) {\n      newState = 'connecting';\n    } else if (states.disconnected > 0) {\n      newState = 'disconnected';\n    } else if (states.new > 0) {\n      newState = 'new';\n    } else if (states.connected > 0 || states.completed > 0) {\n      newState = 'connected';\n    }\n\n    if (newState !== this.iceConnectionState) {\n      this.iceConnectionState = newState;\n      var event = new Event('iceconnectionstatechange');\n      this.dispatchEvent(event);\n      if (typeof this.oniceconnectionstatechange === 'function') {\n        this.oniceconnectionstatechange(event);\n      }\n    }\n  };\n\n  RTCPeerConnection.prototype.createOffer = function() {\n    var self = this;\n    var args = arguments;\n\n    var offerOptions;\n    if (arguments.length === 1 && typeof arguments[0] !== 'function') {\n      offerOptions = arguments[0];\n    } else if (arguments.length === 3) {\n      offerOptions = arguments[2];\n    }\n\n    var numAudioTracks = this.transceivers.filter(function(t) {\n      return t.kind === 'audio';\n    }).length;\n    var numVideoTracks = this.transceivers.filter(function(t) {\n      return t.kind === 'video';\n    }).length;\n\n    // Determine number of audio and video tracks we need to send/recv.\n    if (offerOptions) {\n      // Reject Chrome legacy constraints.\n      if (offerOptions.mandatory || offerOptions.optional) {\n        throw new TypeError(\n            'Legacy mandatory/optional constraints not supported.');\n      }\n      if (offerOptions.offerToReceiveAudio !== undefined) {\n        if (offerOptions.offerToReceiveAudio === true) {\n          numAudioTracks = 1;\n        } else if (offerOptions.offerToReceiveAudio === false) {\n          numAudioTracks = 0;\n        } else {\n          numAudioTracks = offerOptions.offerToReceiveAudio;\n        }\n      }\n      if (offerOptions.offerToReceiveVideo !== undefined) {\n        if (offerOptions.offerToReceiveVideo === true) {\n          numVideoTracks = 1;\n        } else if (offerOptions.offerToReceiveVideo === false) {\n          numVideoTracks = 0;\n        } else {\n          numVideoTracks = offerOptions.offerToReceiveVideo;\n        }\n      }\n    }\n\n    this.transceivers.forEach(function(transceiver) {\n      if (transceiver.kind === 'audio') {\n        numAudioTracks--;\n        if (numAudioTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      } else if (transceiver.kind === 'video') {\n        numVideoTracks--;\n        if (numVideoTracks < 0) {\n          transceiver.wantReceive = false;\n        }\n      }\n    });\n\n    // Create M-lines for recvonly streams.\n    while (numAudioTracks > 0 || numVideoTracks > 0) {\n      if (numAudioTracks > 0) {\n        this._createTransceiver('audio');\n        numAudioTracks--;\n      }\n      if (numVideoTracks > 0) {\n        this._createTransceiver('video');\n        numVideoTracks--;\n      }\n    }\n\n    var sdp = SDPUtils.writeSessionBoilerplate(this._sdpSessionId,\n        this._sdpSessionVersion++);\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      // For each track, create an ice gatherer, ice transport,\n      // dtls transport, potentially rtpsender and rtpreceiver.\n      var track = transceiver.track;\n      var kind = transceiver.kind;\n      var mid = SDPUtils.generateIdentifier();\n      transceiver.mid = mid;\n\n      if (!transceiver.iceGatherer) {\n        transceiver.iceGatherer = self._createIceGatherer(sdpMLineIndex,\n            self.usingBundle);\n      }\n\n      var localCapabilities = window.RTCRtpSender.getCapabilities(kind);\n      // filter RTX until additional stuff needed for RTX is implemented\n      // in adapter.js\n      if (edgeVersion < 15019) {\n        localCapabilities.codecs = localCapabilities.codecs.filter(\n            function(codec) {\n              return codec.name !== 'rtx';\n            });\n      }\n      localCapabilities.codecs.forEach(function(codec) {\n        // work around https://bugs.chromium.org/p/webrtc/issues/detail?id=6552\n        // by adding level-asymmetry-allowed=1\n        if (codec.name === 'H264' &&\n            codec.parameters['level-asymmetry-allowed'] === undefined) {\n          codec.parameters['level-asymmetry-allowed'] = '1';\n        }\n      });\n\n      // generate an ssrc now, to be used later in rtpSender.send\n      var sendEncodingParameters = transceiver.sendEncodingParameters || [{\n        ssrc: (2 * sdpMLineIndex + 1) * 1001\n      }];\n      if (track) {\n        // add RTX\n        if (edgeVersion >= 15019 && kind === 'video' &&\n            !sendEncodingParameters[0].rtx) {\n          sendEncodingParameters[0].rtx = {\n            ssrc: sendEncodingParameters[0].ssrc + 1\n          };\n        }\n      }\n\n      if (transceiver.wantReceive) {\n        transceiver.rtpReceiver = new window.RTCRtpReceiver(\n            transceiver.dtlsTransport, kind);\n      }\n\n      transceiver.localCapabilities = localCapabilities;\n      transceiver.sendEncodingParameters = sendEncodingParameters;\n    });\n\n    // always offer BUNDLE and dispose on return if not supported.\n    if (this._config.bundlePolicy !== 'max-compat') {\n      sdp += 'a=group:BUNDLE ' + this.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    sdp += 'a=ice-options:trickle\\r\\n';\n\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      sdp += writeMediaSection(transceiver, transceiver.localCapabilities,\n          'offer', transceiver.stream, self._dtlsRole);\n      sdp += 'a=rtcp-rsize\\r\\n';\n\n      if (transceiver.iceGatherer && self.iceGatheringState !== 'new' &&\n          (sdpMLineIndex === 0 || !self.usingBundle)) {\n        transceiver.iceGatherer.getLocalCandidates().forEach(function(cand) {\n          cand.component = 1;\n          sdp += 'a=' + SDPUtils.writeCandidate(cand) + '\\r\\n';\n        });\n\n        if (transceiver.iceGatherer.state === 'completed') {\n          sdp += 'a=end-of-candidates\\r\\n';\n        }\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'offer',\n      sdp: sdp\n    });\n    return new Promise(function(resolve) {\n      if (args.length > 0 && typeof args[0] === 'function') {\n        args[0].apply(null, [desc]);\n        resolve();\n        return;\n      }\n      resolve(desc);\n    });\n  };\n\n  RTCPeerConnection.prototype.createAnswer = function() {\n    var self = this;\n    var args = arguments;\n\n    var sdp = SDPUtils.writeSessionBoilerplate(this._sdpSessionId,\n        this._sdpSessionVersion++);\n    if (this.usingBundle) {\n      sdp += 'a=group:BUNDLE ' + this.transceivers.map(function(t) {\n        return t.mid;\n      }).join(' ') + '\\r\\n';\n    }\n    var mediaSectionsInOffer = SDPUtils.splitSections(\n        this.remoteDescription.sdp).length - 1;\n    this.transceivers.forEach(function(transceiver, sdpMLineIndex) {\n      if (sdpMLineIndex + 1 > mediaSectionsInOffer) {\n        return;\n      }\n      if (transceiver.isDatachannel) {\n        sdp += 'm=application 0 DTLS/SCTP 5000\\r\\n' +\n            'c=IN IP4 0.0.0.0\\r\\n' +\n            'a=mid:' + transceiver.mid + '\\r\\n';\n        return;\n      }\n\n      // FIXME: look at direction.\n      if (transceiver.stream) {\n        var localTrack;\n        if (transceiver.kind === 'audio') {\n          localTrack = transceiver.stream.getAudioTracks()[0];\n        } else if (transceiver.kind === 'video') {\n          localTrack = transceiver.stream.getVideoTracks()[0];\n        }\n        if (localTrack) {\n          // add RTX\n          if (edgeVersion >= 15019 && transceiver.kind === 'video' &&\n              !transceiver.sendEncodingParameters[0].rtx) {\n            transceiver.sendEncodingParameters[0].rtx = {\n              ssrc: transceiver.sendEncodingParameters[0].ssrc + 1\n            };\n          }\n        }\n      }\n\n      // Calculate intersection of capabilities.\n      var commonCapabilities = getCommonCapabilities(\n          transceiver.localCapabilities,\n          transceiver.remoteCapabilities);\n\n      var hasRtx = commonCapabilities.codecs.filter(function(c) {\n        return c.name.toLowerCase() === 'rtx';\n      }).length;\n      if (!hasRtx && transceiver.sendEncodingParameters[0].rtx) {\n        delete transceiver.sendEncodingParameters[0].rtx;\n      }\n\n      sdp += writeMediaSection(transceiver, commonCapabilities,\n          'answer', transceiver.stream, self._dtlsRole);\n      if (transceiver.rtcpParameters &&\n          transceiver.rtcpParameters.reducedSize) {\n        sdp += 'a=rtcp-rsize\\r\\n';\n      }\n    });\n\n    var desc = new window.RTCSessionDescription({\n      type: 'answer',\n      sdp: sdp\n    });\n    return new Promise(function(resolve) {\n      if (args.length > 0 && typeof args[0] === 'function') {\n        args[0].apply(null, [desc]);\n        resolve();\n        return;\n      }\n      resolve(desc);\n    });\n  };\n\n  RTCPeerConnection.prototype.addIceCandidate = function(candidate) {\n    var err;\n    var sections;\n    if (!candidate || candidate.candidate === '') {\n      for (var j = 0; j < this.transceivers.length; j++) {\n        if (this.transceivers[j].isDatachannel) {\n          continue;\n        }\n        this.transceivers[j].iceTransport.addRemoteCandidate({});\n        sections = SDPUtils.splitSections(this.remoteDescription.sdp);\n        sections[j + 1] += 'a=end-of-candidates\\r\\n';\n        this.remoteDescription.sdp = sections.join('');\n        if (this.usingBundle) {\n          break;\n        }\n      }\n    } else if (!(candidate.sdpMLineIndex !== undefined || candidate.sdpMid)) {\n      throw new TypeError('sdpMLineIndex or sdpMid required');\n    } else if (!this.remoteDescription) {\n      err = new Error('Can not add ICE candidate without ' +\n          'a remote description');\n      err.name = 'InvalidStateError';\n    } else {\n      var sdpMLineIndex = candidate.sdpMLineIndex;\n      if (candidate.sdpMid) {\n        for (var i = 0; i < this.transceivers.length; i++) {\n          if (this.transceivers[i].mid === candidate.sdpMid) {\n            sdpMLineIndex = i;\n            break;\n          }\n        }\n      }\n      var transceiver = this.transceivers[sdpMLineIndex];\n      if (transceiver) {\n        if (transceiver.isDatachannel) {\n          return Promise.resolve();\n        }\n        var cand = Object.keys(candidate.candidate).length > 0 ?\n            SDPUtils.parseCandidate(candidate.candidate) : {};\n        // Ignore Chrome's invalid candidates since Edge does not like them.\n        if (cand.protocol === 'tcp' && (cand.port === 0 || cand.port === 9)) {\n          return Promise.resolve();\n        }\n        // Ignore RTCP candidates, we assume RTCP-MUX.\n        if (cand.component && cand.component !== 1) {\n          return Promise.resolve();\n        }\n        // when using bundle, avoid adding candidates to the wrong\n        // ice transport. And avoid adding candidates added in the SDP.\n        if (sdpMLineIndex === 0 || (sdpMLineIndex > 0 &&\n            transceiver.iceTransport !== this.transceivers[0].iceTransport)) {\n          if (!maybeAddCandidate(transceiver.iceTransport, cand)) {\n            err = new Error('Can not add ICE candidate');\n            err.name = 'OperationError';\n          }\n        }\n\n        if (!err) {\n          // update the remoteDescription.\n          var candidateString = candidate.candidate.trim();\n          if (candidateString.indexOf('a=') === 0) {\n            candidateString = candidateString.substr(2);\n          }\n          sections = SDPUtils.splitSections(this.remoteDescription.sdp);\n          sections[sdpMLineIndex + 1] += 'a=' +\n              (cand.type ? candidateString : 'end-of-candidates')\n              + '\\r\\n';\n          this.remoteDescription.sdp = sections.join('');\n        }\n      } else {\n        err = new Error('Can not add ICE candidate');\n        err.name = 'OperationError';\n      }\n    }\n    var args = arguments;\n    return new Promise(function(resolve, reject) {\n      if (err) {\n        if (args.length > 2 && typeof args[2] === 'function') {\n          args[2].apply(null, [err]);\n        }\n        reject(err);\n      } else {\n        if (args.length > 1 && typeof args[1] === 'function') {\n          args[1].apply(null);\n        }\n        resolve();\n      }\n    });\n  };\n\n  RTCPeerConnection.prototype.getStats = function() {\n    var promises = [];\n    this.transceivers.forEach(function(transceiver) {\n      ['rtpSender', 'rtpReceiver', 'iceGatherer', 'iceTransport',\n          'dtlsTransport'].forEach(function(method) {\n            if (transceiver[method]) {\n              promises.push(transceiver[method].getStats());\n            }\n          });\n    });\n    var cb = arguments.length > 1 && typeof arguments[1] === 'function' &&\n        arguments[1];\n    var fixStatsType = function(stat) {\n      return {\n        inboundrtp: 'inbound-rtp',\n        outboundrtp: 'outbound-rtp',\n        candidatepair: 'candidate-pair',\n        localcandidate: 'local-candidate',\n        remotecandidate: 'remote-candidate'\n      }[stat.type] || stat.type;\n    };\n    return new Promise(function(resolve) {\n      // shim getStats with maplike support\n      var results = new Map();\n      Promise.all(promises).then(function(res) {\n        res.forEach(function(result) {\n          Object.keys(result).forEach(function(id) {\n            result[id].type = fixStatsType(result[id]);\n            results.set(id, result[id]);\n          });\n        });\n        if (cb) {\n          cb.apply(null, results);\n        }\n        resolve(results);\n      });\n    });\n  };\n  return RTCPeerConnection;\n};\n\n},{\"sdp\":2}],2:[function(require,module,exports){\n /* eslint-env node */\n'use strict';\n\n// SDP helpers.\nvar SDPUtils = {};\n\n// Generate an alphanumeric identifier for cname or mids.\n// TODO: use UUIDs instead? https://gist.github.com/jed/982883\nSDPUtils.generateIdentifier = function() {\n  return Math.random().toString(36).substr(2, 10);\n};\n\n// The RTCP CNAME used by all peerconnections from the same JS.\nSDPUtils.localCName = SDPUtils.generateIdentifier();\n\n// Splits SDP into lines, dealing with both CRLF and LF.\nSDPUtils.splitLines = function(blob) {\n  return blob.trim().split('\\n').map(function(line) {\n    return line.trim();\n  });\n};\n// Splits SDP into sessionpart and mediasections. Ensures CRLF.\nSDPUtils.splitSections = function(blob) {\n  var parts = blob.split('\\nm=');\n  return parts.map(function(part, index) {\n    return (index > 0 ? 'm=' + part : part).trim() + '\\r\\n';\n  });\n};\n\n// Returns lines that start with a certain prefix.\nSDPUtils.matchPrefix = function(blob, prefix) {\n  return SDPUtils.splitLines(blob).filter(function(line) {\n    return line.indexOf(prefix) === 0;\n  });\n};\n\n// Parses an ICE candidate line. Sample input:\n// candidate:702786350 2 udp 41819902 8.8.8.8 60769 typ relay raddr 8.8.8.8\n// rport 55996\"\nSDPUtils.parseCandidate = function(line) {\n  var parts;\n  // Parse both variants.\n  if (line.indexOf('a=candidate:') === 0) {\n    parts = line.substring(12).split(' ');\n  } else {\n    parts = line.substring(10).split(' ');\n  }\n\n  var candidate = {\n    foundation: parts[0],\n    component: parseInt(parts[1], 10),\n    protocol: parts[2].toLowerCase(),\n    priority: parseInt(parts[3], 10),\n    ip: parts[4],\n    port: parseInt(parts[5], 10),\n    // skip parts[6] == 'typ'\n    type: parts[7]\n  };\n\n  for (var i = 8; i < parts.length; i += 2) {\n    switch (parts[i]) {\n      case 'raddr':\n        candidate.relatedAddress = parts[i + 1];\n        break;\n      case 'rport':\n        candidate.relatedPort = parseInt(parts[i + 1], 10);\n        break;\n      case 'tcptype':\n        candidate.tcpType = parts[i + 1];\n        break;\n      case 'ufrag':\n        candidate.ufrag = parts[i + 1]; // for backward compability.\n        candidate.usernameFragment = parts[i + 1];\n        break;\n      default: // extension handling, in particular ufrag\n        candidate[parts[i]] = parts[i + 1];\n        break;\n    }\n  }\n  return candidate;\n};\n\n// Translates a candidate object into SDP candidate attribute.\nSDPUtils.writeCandidate = function(candidate) {\n  var sdp = [];\n  sdp.push(candidate.foundation);\n  sdp.push(candidate.component);\n  sdp.push(candidate.protocol.toUpperCase());\n  sdp.push(candidate.priority);\n  sdp.push(candidate.ip);\n  sdp.push(candidate.port);\n\n  var type = candidate.type;\n  sdp.push('typ');\n  sdp.push(type);\n  if (type !== 'host' && candidate.relatedAddress &&\n      candidate.relatedPort) {\n    sdp.push('raddr');\n    sdp.push(candidate.relatedAddress); // was: relAddr\n    sdp.push('rport');\n    sdp.push(candidate.relatedPort); // was: relPort\n  }\n  if (candidate.tcpType && candidate.protocol.toLowerCase() === 'tcp') {\n    sdp.push('tcptype');\n    sdp.push(candidate.tcpType);\n  }\n  if (candidate.ufrag) {\n    sdp.push('ufrag');\n    sdp.push(candidate.ufrag);\n  }\n  return 'candidate:' + sdp.join(' ');\n};\n\n// Parses an ice-options line, returns an array of option tags.\n// a=ice-options:foo bar\nSDPUtils.parseIceOptions = function(line) {\n  return line.substr(14).split(' ');\n}\n\n// Parses an rtpmap line, returns RTCRtpCoddecParameters. Sample input:\n// a=rtpmap:111 opus/48000/2\nSDPUtils.parseRtpMap = function(line) {\n  var parts = line.substr(9).split(' ');\n  var parsed = {\n    payloadType: parseInt(parts.shift(), 10) // was: id\n  };\n\n  parts = parts[0].split('/');\n\n  parsed.name = parts[0];\n  parsed.clockRate = parseInt(parts[1], 10); // was: clockrate\n  // was: channels\n  parsed.numChannels = parts.length === 3 ? parseInt(parts[2], 10) : 1;\n  return parsed;\n};\n\n// Generate an a=rtpmap line from RTCRtpCodecCapability or\n// RTCRtpCodecParameters.\nSDPUtils.writeRtpMap = function(codec) {\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  return 'a=rtpmap:' + pt + ' ' + codec.name + '/' + codec.clockRate +\n      (codec.numChannels !== 1 ? '/' + codec.numChannels : '') + '\\r\\n';\n};\n\n// Parses an a=extmap line (headerextension from RFC 5285). Sample input:\n// a=extmap:2 urn:ietf:params:rtp-hdrext:toffset\n// a=extmap:2/sendonly urn:ietf:params:rtp-hdrext:toffset\nSDPUtils.parseExtmap = function(line) {\n  var parts = line.substr(9).split(' ');\n  return {\n    id: parseInt(parts[0], 10),\n    direction: parts[0].indexOf('/') > 0 ? parts[0].split('/')[1] : 'sendrecv',\n    uri: parts[1]\n  };\n};\n\n// Generates a=extmap line from RTCRtpHeaderExtensionParameters or\n// RTCRtpHeaderExtension.\nSDPUtils.writeExtmap = function(headerExtension) {\n  return 'a=extmap:' + (headerExtension.id || headerExtension.preferredId) +\n      (headerExtension.direction && headerExtension.direction !== 'sendrecv'\n          ? '/' + headerExtension.direction\n          : '') +\n      ' ' + headerExtension.uri + '\\r\\n';\n};\n\n// Parses an ftmp line, returns dictionary. Sample input:\n// a=fmtp:96 vbr=on;cng=on\n// Also deals with vbr=on; cng=on\nSDPUtils.parseFmtp = function(line) {\n  var parsed = {};\n  var kv;\n  var parts = line.substr(line.indexOf(' ') + 1).split(';');\n  for (var j = 0; j < parts.length; j++) {\n    kv = parts[j].trim().split('=');\n    parsed[kv[0].trim()] = kv[1];\n  }\n  return parsed;\n};\n\n// Generates an a=ftmp line from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeFmtp = function(codec) {\n  var line = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.parameters && Object.keys(codec.parameters).length) {\n    var params = [];\n    Object.keys(codec.parameters).forEach(function(param) {\n      params.push(param + '=' + codec.parameters[param]);\n    });\n    line += 'a=fmtp:' + pt + ' ' + params.join(';') + '\\r\\n';\n  }\n  return line;\n};\n\n// Parses an rtcp-fb line, returns RTCPRtcpFeedback object. Sample input:\n// a=rtcp-fb:98 nack rpsi\nSDPUtils.parseRtcpFb = function(line) {\n  var parts = line.substr(line.indexOf(' ') + 1).split(' ');\n  return {\n    type: parts.shift(),\n    parameter: parts.join(' ')\n  };\n};\n// Generate a=rtcp-fb lines from RTCRtpCodecCapability or RTCRtpCodecParameters.\nSDPUtils.writeRtcpFb = function(codec) {\n  var lines = '';\n  var pt = codec.payloadType;\n  if (codec.preferredPayloadType !== undefined) {\n    pt = codec.preferredPayloadType;\n  }\n  if (codec.rtcpFeedback && codec.rtcpFeedback.length) {\n    // FIXME: special handling for trr-int?\n    codec.rtcpFeedback.forEach(function(fb) {\n      lines += 'a=rtcp-fb:' + pt + ' ' + fb.type +\n      (fb.parameter && fb.parameter.length ? ' ' + fb.parameter : '') +\n          '\\r\\n';\n    });\n  }\n  return lines;\n};\n\n// Parses an RFC 5576 ssrc media attribute. Sample input:\n// a=ssrc:3735928559 cname:something\nSDPUtils.parseSsrcMedia = function(line) {\n  var sp = line.indexOf(' ');\n  var parts = {\n    ssrc: parseInt(line.substr(7, sp - 7), 10)\n  };\n  var colon = line.indexOf(':', sp);\n  if (colon > -1) {\n    parts.attribute = line.substr(sp + 1, colon - sp - 1);\n    parts.value = line.substr(colon + 1);\n  } else {\n    parts.attribute = line.substr(sp + 1);\n  }\n  return parts;\n};\n\n// Extracts the MID (RFC 5888) from a media section.\n// returns the MID or undefined if no mid line was found.\nSDPUtils.getMid = function(mediaSection) {\n  var mid = SDPUtils.matchPrefix(mediaSection, 'a=mid:')[0];\n  if (mid) {\n    return mid.substr(6);\n  }\n}\n\nSDPUtils.parseFingerprint = function(line) {\n  var parts = line.substr(14).split(' ');\n  return {\n    algorithm: parts[0].toLowerCase(), // algorithm is case-sensitive in Edge.\n    value: parts[1]\n  };\n};\n\n// Extracts DTLS parameters from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the fingerprint line as input. See also getIceParameters.\nSDPUtils.getDtlsParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.matchPrefix(mediaSection + sessionpart,\n      'a=fingerprint:');\n  // Note: a=setup line is ignored since we use the 'auto' role.\n  // Note2: 'algorithm' is not case sensitive except in Edge.\n  return {\n    role: 'auto',\n    fingerprints: lines.map(SDPUtils.parseFingerprint)\n  };\n};\n\n// Serializes DTLS parameters to SDP.\nSDPUtils.writeDtlsParameters = function(params, setupType) {\n  var sdp = 'a=setup:' + setupType + '\\r\\n';\n  params.fingerprints.forEach(function(fp) {\n    sdp += 'a=fingerprint:' + fp.algorithm + ' ' + fp.value + '\\r\\n';\n  });\n  return sdp;\n};\n// Parses ICE information from SDP media section or sessionpart.\n// FIXME: for consistency with other functions this should only\n//   get the ice-ufrag and ice-pwd lines as input.\nSDPUtils.getIceParameters = function(mediaSection, sessionpart) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  // Search in session part, too.\n  lines = lines.concat(SDPUtils.splitLines(sessionpart));\n  var iceParameters = {\n    usernameFragment: lines.filter(function(line) {\n      return line.indexOf('a=ice-ufrag:') === 0;\n    })[0].substr(12),\n    password: lines.filter(function(line) {\n      return line.indexOf('a=ice-pwd:') === 0;\n    })[0].substr(10)\n  };\n  return iceParameters;\n};\n\n// Serializes ICE parameters to SDP.\nSDPUtils.writeIceParameters = function(params) {\n  return 'a=ice-ufrag:' + params.usernameFragment + '\\r\\n' +\n      'a=ice-pwd:' + params.password + '\\r\\n';\n};\n\n// Parses the SDP media section and returns RTCRtpParameters.\nSDPUtils.parseRtpParameters = function(mediaSection) {\n  var description = {\n    codecs: [],\n    headerExtensions: [],\n    fecMechanisms: [],\n    rtcp: []\n  };\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  for (var i = 3; i < mline.length; i++) { // find all codecs from mline[3..]\n    var pt = mline[i];\n    var rtpmapline = SDPUtils.matchPrefix(\n        mediaSection, 'a=rtpmap:' + pt + ' ')[0];\n    if (rtpmapline) {\n      var codec = SDPUtils.parseRtpMap(rtpmapline);\n      var fmtps = SDPUtils.matchPrefix(\n          mediaSection, 'a=fmtp:' + pt + ' ');\n      // Only the first a=fmtp:<pt> is considered.\n      codec.parameters = fmtps.length ? SDPUtils.parseFmtp(fmtps[0]) : {};\n      codec.rtcpFeedback = SDPUtils.matchPrefix(\n          mediaSection, 'a=rtcp-fb:' + pt + ' ')\n        .map(SDPUtils.parseRtcpFb);\n      description.codecs.push(codec);\n      // parse FEC mechanisms from rtpmap lines.\n      switch (codec.name.toUpperCase()) {\n        case 'RED':\n        case 'ULPFEC':\n          description.fecMechanisms.push(codec.name.toUpperCase());\n          break;\n        default: // only RED and ULPFEC are recognized as FEC mechanisms.\n          break;\n      }\n    }\n  }\n  SDPUtils.matchPrefix(mediaSection, 'a=extmap:').forEach(function(line) {\n    description.headerExtensions.push(SDPUtils.parseExtmap(line));\n  });\n  // FIXME: parse rtcp.\n  return description;\n};\n\n// Generates parts of the SDP media section describing the capabilities /\n// parameters.\nSDPUtils.writeRtpDescription = function(kind, caps) {\n  var sdp = '';\n\n  // Build the mline.\n  sdp += 'm=' + kind + ' ';\n  sdp += caps.codecs.length > 0 ? '9' : '0'; // reject if no codecs.\n  sdp += ' UDP/TLS/RTP/SAVPF ';\n  sdp += caps.codecs.map(function(codec) {\n    if (codec.preferredPayloadType !== undefined) {\n      return codec.preferredPayloadType;\n    }\n    return codec.payloadType;\n  }).join(' ') + '\\r\\n';\n\n  sdp += 'c=IN IP4 0.0.0.0\\r\\n';\n  sdp += 'a=rtcp:9 IN IP4 0.0.0.0\\r\\n';\n\n  // Add a=rtpmap lines for each codec. Also fmtp and rtcp-fb.\n  caps.codecs.forEach(function(codec) {\n    sdp += SDPUtils.writeRtpMap(codec);\n    sdp += SDPUtils.writeFmtp(codec);\n    sdp += SDPUtils.writeRtcpFb(codec);\n  });\n  var maxptime = 0;\n  caps.codecs.forEach(function(codec) {\n    if (codec.maxptime > maxptime) {\n      maxptime = codec.maxptime;\n    }\n  });\n  if (maxptime > 0) {\n    sdp += 'a=maxptime:' + maxptime + '\\r\\n';\n  }\n  sdp += 'a=rtcp-mux\\r\\n';\n\n  caps.headerExtensions.forEach(function(extension) {\n    sdp += SDPUtils.writeExtmap(extension);\n  });\n  // FIXME: write fecMechanisms.\n  return sdp;\n};\n\n// Parses the SDP media section and returns an array of\n// RTCRtpEncodingParameters.\nSDPUtils.parseRtpEncodingParameters = function(mediaSection) {\n  var encodingParameters = [];\n  var description = SDPUtils.parseRtpParameters(mediaSection);\n  var hasRed = description.fecMechanisms.indexOf('RED') !== -1;\n  var hasUlpfec = description.fecMechanisms.indexOf('ULPFEC') !== -1;\n\n  // filter a=ssrc:... cname:, ignore PlanB-msid\n  var ssrcs = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'cname';\n  });\n  var primarySsrc = ssrcs.length > 0 && ssrcs[0].ssrc;\n  var secondarySsrc;\n\n  var flows = SDPUtils.matchPrefix(mediaSection, 'a=ssrc-group:FID')\n  .map(function(line) {\n    var parts = line.split(' ');\n    parts.shift();\n    return parts.map(function(part) {\n      return parseInt(part, 10);\n    });\n  });\n  if (flows.length > 0 && flows[0].length > 1 && flows[0][0] === primarySsrc) {\n    secondarySsrc = flows[0][1];\n  }\n\n  description.codecs.forEach(function(codec) {\n    if (codec.name.toUpperCase() === 'RTX' && codec.parameters.apt) {\n      var encParam = {\n        ssrc: primarySsrc,\n        codecPayloadType: parseInt(codec.parameters.apt, 10),\n        rtx: {\n          ssrc: secondarySsrc\n        }\n      };\n      encodingParameters.push(encParam);\n      if (hasRed) {\n        encParam = JSON.parse(JSON.stringify(encParam));\n        encParam.fec = {\n          ssrc: secondarySsrc,\n          mechanism: hasUlpfec ? 'red+ulpfec' : 'red'\n        };\n        encodingParameters.push(encParam);\n      }\n    }\n  });\n  if (encodingParameters.length === 0 && primarySsrc) {\n    encodingParameters.push({\n      ssrc: primarySsrc\n    });\n  }\n\n  // we support both b=AS and b=TIAS but interpret AS as TIAS.\n  var bandwidth = SDPUtils.matchPrefix(mediaSection, 'b=');\n  if (bandwidth.length) {\n    if (bandwidth[0].indexOf('b=TIAS:') === 0) {\n      bandwidth = parseInt(bandwidth[0].substr(7), 10);\n    } else if (bandwidth[0].indexOf('b=AS:') === 0) {\n      // use formula from JSEP to convert b=AS to TIAS value.\n      bandwidth = parseInt(bandwidth[0].substr(5), 10) * 1000 * 0.95\n          - (50 * 40 * 8);\n    } else {\n      bandwidth = undefined;\n    }\n    encodingParameters.forEach(function(params) {\n      params.maxBitrate = bandwidth;\n    });\n  }\n  return encodingParameters;\n};\n\n// parses http://draft.ortc.org/#rtcrtcpparameters*\nSDPUtils.parseRtcpParameters = function(mediaSection) {\n  var rtcpParameters = {};\n\n  var cname;\n  // Gets the first SSRC. Note that with RTX there might be multiple\n  // SSRCs.\n  var remoteSsrc = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n      .map(function(line) {\n        return SDPUtils.parseSsrcMedia(line);\n      })\n      .filter(function(obj) {\n        return obj.attribute === 'cname';\n      })[0];\n  if (remoteSsrc) {\n    rtcpParameters.cname = remoteSsrc.value;\n    rtcpParameters.ssrc = remoteSsrc.ssrc;\n  }\n\n  // Edge uses the compound attribute instead of reducedSize\n  // compound is !reducedSize\n  var rsize = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-rsize');\n  rtcpParameters.reducedSize = rsize.length > 0;\n  rtcpParameters.compound = rsize.length === 0;\n\n  // parses the rtcp-mux attrbute.\n  // Note that Edge does not support unmuxed RTCP.\n  var mux = SDPUtils.matchPrefix(mediaSection, 'a=rtcp-mux');\n  rtcpParameters.mux = mux.length > 0;\n\n  return rtcpParameters;\n};\n\n// parses either a=msid: or a=ssrc:... msid lines and returns\n// the id of the MediaStream and MediaStreamTrack.\nSDPUtils.parseMsid = function(mediaSection) {\n  var parts;\n  var spec = SDPUtils.matchPrefix(mediaSection, 'a=msid:');\n  if (spec.length === 1) {\n    parts = spec[0].substr(7).split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n  var planB = SDPUtils.matchPrefix(mediaSection, 'a=ssrc:')\n  .map(function(line) {\n    return SDPUtils.parseSsrcMedia(line);\n  })\n  .filter(function(parts) {\n    return parts.attribute === 'msid';\n  });\n  if (planB.length > 0) {\n    parts = planB[0].value.split(' ');\n    return {stream: parts[0], track: parts[1]};\n  }\n};\n\n// Generate a session ID for SDP.\n// https://tools.ietf.org/html/draft-ietf-rtcweb-jsep-20#section-5.2.1\n// recommends using a cryptographically random +ve 64-bit value\n// but right now this should be acceptable and within the right range\nSDPUtils.generateSessionId = function() {\n  return Math.random().toString().substr(2, 21);\n};\n\n// Write boilder plate for start of SDP\n// sessId argument is optional - if not supplied it will\n// be generated randomly\n// sessVersion is optional and defaults to 2\nSDPUtils.writeSessionBoilerplate = function(sessId, sessVer) {\n  var sessionId;\n  var version = sessVer !== undefined ? sessVer : 2;\n  if (sessId) {\n    sessionId = sessId;\n  } else {\n    sessionId = SDPUtils.generateSessionId();\n  }\n  // FIXME: sess-id should be an NTP timestamp.\n  return 'v=0\\r\\n' +\n      'o=thisisadapterortc ' + sessionId + ' ' + version + ' IN IP4 127.0.0.1\\r\\n' +\n      's=-\\r\\n' +\n      't=0 0\\r\\n';\n};\n\nSDPUtils.writeMediaSection = function(transceiver, caps, type, stream) {\n  var sdp = SDPUtils.writeRtpDescription(transceiver.kind, caps);\n\n  // Map ICE parameters (ufrag, pwd) to SDP.\n  sdp += SDPUtils.writeIceParameters(\n      transceiver.iceGatherer.getLocalParameters());\n\n  // Map DTLS parameters to SDP.\n  sdp += SDPUtils.writeDtlsParameters(\n      transceiver.dtlsTransport.getLocalParameters(),\n      type === 'offer' ? 'actpass' : 'active');\n\n  sdp += 'a=mid:' + transceiver.mid + '\\r\\n';\n\n  if (transceiver.direction) {\n    sdp += 'a=' + transceiver.direction + '\\r\\n';\n  } else if (transceiver.rtpSender && transceiver.rtpReceiver) {\n    sdp += 'a=sendrecv\\r\\n';\n  } else if (transceiver.rtpSender) {\n    sdp += 'a=sendonly\\r\\n';\n  } else if (transceiver.rtpReceiver) {\n    sdp += 'a=recvonly\\r\\n';\n  } else {\n    sdp += 'a=inactive\\r\\n';\n  }\n\n  if (transceiver.rtpSender) {\n    // spec.\n    var msid = 'msid:' + stream.id + ' ' +\n        transceiver.rtpSender.track.id + '\\r\\n';\n    sdp += 'a=' + msid;\n\n    // for Chrome.\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n        ' ' + msid;\n    if (transceiver.sendEncodingParameters[0].rtx) {\n      sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n          ' ' + msid;\n      sdp += 'a=ssrc-group:FID ' +\n          transceiver.sendEncodingParameters[0].ssrc + ' ' +\n          transceiver.sendEncodingParameters[0].rtx.ssrc +\n          '\\r\\n';\n    }\n  }\n  // FIXME: this should be written by writeRtpDescription.\n  sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].ssrc +\n      ' cname:' + SDPUtils.localCName + '\\r\\n';\n  if (transceiver.rtpSender && transceiver.sendEncodingParameters[0].rtx) {\n    sdp += 'a=ssrc:' + transceiver.sendEncodingParameters[0].rtx.ssrc +\n        ' cname:' + SDPUtils.localCName + '\\r\\n';\n  }\n  return sdp;\n};\n\n// Gets the direction from the mediaSection or the sessionpart.\nSDPUtils.getDirection = function(mediaSection, sessionpart) {\n  // Look for sendrecv, sendonly, recvonly, inactive, default to sendrecv.\n  var lines = SDPUtils.splitLines(mediaSection);\n  for (var i = 0; i < lines.length; i++) {\n    switch (lines[i]) {\n      case 'a=sendrecv':\n      case 'a=sendonly':\n      case 'a=recvonly':\n      case 'a=inactive':\n        return lines[i].substr(2);\n      default:\n        // FIXME: What should happen here?\n    }\n  }\n  if (sessionpart) {\n    return SDPUtils.getDirection(sessionpart);\n  }\n  return 'sendrecv';\n};\n\nSDPUtils.getKind = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return mline[0].substr(2);\n};\n\nSDPUtils.isRejected = function(mediaSection) {\n  return mediaSection.split(' ', 2)[1] === '0';\n};\n\nSDPUtils.parseMLine = function(mediaSection) {\n  var lines = SDPUtils.splitLines(mediaSection);\n  var mline = lines[0].split(' ');\n  return {\n    kind: mline[0].substr(2),\n    port: parseInt(mline[1], 10),\n    protocol: mline[2],\n    fmt: mline.slice(3).join(' ')\n  };\n};\n\n// Expose public methods.\nif (typeof module === 'object') {\n  module.exports = SDPUtils;\n}\n\n},{}],3:[function(require,module,exports){\n(function (global){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\nvar adapterFactory = require('./adapter_factory.js');\nmodule.exports = adapterFactory({window: global.window});\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{\"./adapter_factory.js\":4}],4:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n\n'use strict';\n\nvar utils = require('./utils');\n// Shimming starts here.\nmodule.exports = function(dependencies, opts) {\n  var window = dependencies && dependencies.window;\n\n  var options = {\n    shimChrome: true,\n    shimFirefox: true,\n    shimEdge: true,\n    shimSafari: true,\n  };\n\n  for (var key in opts) {\n    if (hasOwnProperty.call(opts, key)) {\n      options[key] = opts[key];\n    }\n  }\n\n  // Utils.\n  var logging = utils.log;\n  var browserDetails = utils.detectBrowser(window);\n\n  // Export to the adapter global object visible in the browser.\n  var adapter = {\n    browserDetails: browserDetails,\n    extractVersion: utils.extractVersion,\n    disableLog: utils.disableLog,\n    disableWarnings: utils.disableWarnings\n  };\n\n  // Uncomment the line below if you want logging to occur, including logging\n  // for the switch statement below. Can also be turned on in the browser via\n  // adapter.disableLog(false), but then logging from the switch statement below\n  // will not appear.\n  // require('./utils').disableLog(false);\n\n  // Browser shims.\n  var chromeShim = require('./chrome/chrome_shim') || null;\n  var edgeShim = require('./edge/edge_shim') || null;\n  var firefoxShim = require('./firefox/firefox_shim') || null;\n  var safariShim = require('./safari/safari_shim') || null;\n  var commonShim = require('./common_shim') || null;\n\n  // Shim browser if found.\n  switch (browserDetails.browser) {\n    case 'chrome':\n      if (!chromeShim || !chromeShim.shimPeerConnection ||\n          !options.shimChrome) {\n        logging('Chrome shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming chrome.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = chromeShim;\n      commonShim.shimCreateObjectURL(window);\n\n      chromeShim.shimGetUserMedia(window);\n      chromeShim.shimMediaStream(window);\n      chromeShim.shimSourceObject(window);\n      chromeShim.shimPeerConnection(window);\n      chromeShim.shimOnTrack(window);\n      chromeShim.shimAddTrackRemoveTrack(window);\n      chromeShim.shimGetSendersWithDtmf(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    case 'firefox':\n      if (!firefoxShim || !firefoxShim.shimPeerConnection ||\n          !options.shimFirefox) {\n        logging('Firefox shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming firefox.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = firefoxShim;\n      commonShim.shimCreateObjectURL(window);\n\n      firefoxShim.shimGetUserMedia(window);\n      firefoxShim.shimSourceObject(window);\n      firefoxShim.shimPeerConnection(window);\n      firefoxShim.shimOnTrack(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    case 'edge':\n      if (!edgeShim || !edgeShim.shimPeerConnection || !options.shimEdge) {\n        logging('MS edge shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming edge.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = edgeShim;\n      commonShim.shimCreateObjectURL(window);\n\n      edgeShim.shimGetUserMedia(window);\n      edgeShim.shimPeerConnection(window);\n      edgeShim.shimReplaceTrack(window);\n\n      // the edge shim implements the full RTCIceCandidate object.\n      break;\n    case 'safari':\n      if (!safariShim || !options.shimSafari) {\n        logging('Safari shim is not included in this adapter release.');\n        return adapter;\n      }\n      logging('adapter.js shimming safari.');\n      // Export to the adapter global object visible in the browser.\n      adapter.browserShim = safariShim;\n      commonShim.shimCreateObjectURL(window);\n\n      safariShim.shimRTCIceServerUrls(window);\n      safariShim.shimCallbacksAPI(window);\n      safariShim.shimLocalStreamsAPI(window);\n      safariShim.shimRemoteStreamsAPI(window);\n      safariShim.shimTrackEventTransceiver(window);\n      safariShim.shimGetUserMedia(window);\n      safariShim.shimCreateOfferLegacy(window);\n\n      commonShim.shimRTCIceCandidate(window);\n      break;\n    default:\n      logging('Unsupported browser!');\n      break;\n  }\n\n  return adapter;\n};\n\n},{\"./chrome/chrome_shim\":5,\"./common_shim\":7,\"./edge/edge_shim\":8,\"./firefox/firefox_shim\":10,\"./safari/safari_shim\":12,\"./utils\":13}],5:[function(require,module,exports){\n\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar utils = require('../utils.js');\nvar logging = utils.log;\n\nvar chromeShim = {\n  shimMediaStream: function(window) {\n    window.MediaStream = window.MediaStream || window.webkitMediaStream;\n  },\n\n  shimOnTrack: function(window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n          }\n          this.addEventListener('track', this._ontrack = f);\n        }\n      });\n      var origSetRemoteDescription =\n          window.RTCPeerConnection.prototype.setRemoteDescription;\n      window.RTCPeerConnection.prototype.setRemoteDescription = function() {\n        var pc = this;\n        if (!pc._ontrackpoly) {\n          pc._ontrackpoly = function(e) {\n            // onaddstream does not fire when a track is added to an existing\n            // stream. But stream.onaddtrack is implemented so we use that.\n            e.stream.addEventListener('addtrack', function(te) {\n              var receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = pc.getReceivers().find(function(r) {\n                  return r.track && r.track.id === te.track.id;\n                });\n              } else {\n                receiver = {track: te.track};\n              }\n\n              var event = new Event('track');\n              event.track = te.track;\n              event.receiver = receiver;\n              event.transceiver = {receiver: receiver};\n              event.streams = [e.stream];\n              pc.dispatchEvent(event);\n            });\n            e.stream.getTracks().forEach(function(track) {\n              var receiver;\n              if (window.RTCPeerConnection.prototype.getReceivers) {\n                receiver = pc.getReceivers().find(function(r) {\n                  return r.track && r.track.id === track.id;\n                });\n              } else {\n                receiver = {track: track};\n              }\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = receiver;\n              event.transceiver = {receiver: receiver};\n              event.streams = [e.stream];\n              pc.dispatchEvent(event);\n            });\n          };\n          pc.addEventListener('addstream', pc._ontrackpoly);\n        }\n        return origSetRemoteDescription.apply(pc, arguments);\n      };\n    }\n  },\n\n  shimGetSendersWithDtmf: function(window) {\n    // Overrides addTrack/removeTrack, depends on shimAddTrackRemoveTrack.\n    if (typeof window === 'object' && window.RTCPeerConnection &&\n        !('getSenders' in window.RTCPeerConnection.prototype) &&\n        'createDTMFSender' in window.RTCPeerConnection.prototype) {\n      var shimSenderWithDtmf = function(pc, track) {\n        return {\n          track: track,\n          get dtmf() {\n            if (this._dtmf === undefined) {\n              if (track.kind === 'audio') {\n                this._dtmf = pc.createDTMFSender(track);\n              } else {\n                this._dtmf = null;\n              }\n            }\n            return this._dtmf;\n          },\n          _pc: pc\n        };\n      };\n\n      // augment addTrack when getSenders is not available.\n      if (!window.RTCPeerConnection.prototype.getSenders) {\n        window.RTCPeerConnection.prototype.getSenders = function() {\n          this._senders = this._senders || [];\n          return this._senders.slice(); // return a copy of the internal state.\n        };\n        var origAddTrack = window.RTCPeerConnection.prototype.addTrack;\n        window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n          var pc = this;\n          var sender = origAddTrack.apply(pc, arguments);\n          if (!sender) {\n            sender = shimSenderWithDtmf(pc, track);\n            pc._senders.push(sender);\n          }\n          return sender;\n        };\n\n        var origRemoveTrack = window.RTCPeerConnection.prototype.removeTrack;\n        window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n          var pc = this;\n          origRemoveTrack.apply(pc, arguments);\n          var idx = pc._senders.indexOf(sender);\n          if (idx !== -1) {\n            pc._senders.splice(idx, 1);\n          }\n        };\n      }\n      var origAddStream = window.RTCPeerConnection.prototype.addStream;\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\n        var pc = this;\n        pc._senders = pc._senders || [];\n        origAddStream.apply(pc, [stream]);\n        stream.getTracks().forEach(function(track) {\n          pc._senders.push(shimSenderWithDtmf(pc, track));\n        });\n      };\n\n      var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\n        var pc = this;\n        pc._senders = pc._senders || [];\n        origRemoveStream.apply(pc, [stream]);\n\n        stream.getTracks().forEach(function(track) {\n          var sender = pc._senders.find(function(s) {\n            return s.track === track;\n          });\n          if (sender) {\n            pc._senders.splice(pc._senders.indexOf(sender), 1); // remove sender\n          }\n        });\n      };\n    } else if (typeof window === 'object' && window.RTCPeerConnection &&\n               'getSenders' in window.RTCPeerConnection.prototype &&\n               'createDTMFSender' in window.RTCPeerConnection.prototype &&\n               window.RTCRtpSender &&\n               !('dtmf' in window.RTCRtpSender.prototype)) {\n      var origGetSenders = window.RTCPeerConnection.prototype.getSenders;\n      window.RTCPeerConnection.prototype.getSenders = function() {\n        var pc = this;\n        var senders = origGetSenders.apply(pc, []);\n        senders.forEach(function(sender) {\n          sender._pc = pc;\n        });\n        return senders;\n      };\n\n      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n        get: function() {\n          if (this._dtmf === undefined) {\n            if (this.track.kind === 'audio') {\n              this._dtmf = this._pc.createDTMFSender(this.track);\n            } else {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function(window) {\n    var URL = window && window.URL;\n\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this._srcObject;\n          },\n          set: function(stream) {\n            var self = this;\n            // Use _srcObject as a private property for this shim\n            this._srcObject = stream;\n            if (this.src) {\n              URL.revokeObjectURL(this.src);\n            }\n\n            if (!stream) {\n              this.src = '';\n              return undefined;\n            }\n            this.src = URL.createObjectURL(stream);\n            // We need to recreate the blob url when a track is added or\n            // removed. Doing it manually since we want to avoid a recursion.\n            stream.addEventListener('addtrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n            stream.addEventListener('removetrack', function() {\n              if (self.src) {\n                URL.revokeObjectURL(self.src);\n              }\n              self.src = URL.createObjectURL(stream);\n            });\n          }\n        });\n      }\n    }\n  },\n\n  shimAddTrackRemoveTrack: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n    // shim addTrack and removeTrack.\n    if (window.RTCPeerConnection.prototype.addTrack &&\n        browserDetails.version >= 63) {\n      return;\n    }\n\n    // also shim pc.getLocalStreams when addTrack is shimmed\n    // to return the original streams.\n    var origGetLocalStreams = window.RTCPeerConnection.prototype\n        .getLocalStreams;\n    window.RTCPeerConnection.prototype.getLocalStreams = function() {\n      var self = this;\n      var nativeStreams = origGetLocalStreams.apply(this);\n      self._reverseStreams = self._reverseStreams || {};\n      return nativeStreams.map(function(stream) {\n        return self._reverseStreams[stream.id];\n      });\n    };\n\n    var origAddStream = window.RTCPeerConnection.prototype.addStream;\n    window.RTCPeerConnection.prototype.addStream = function(stream) {\n      var pc = this;\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n\n      stream.getTracks().forEach(function(track) {\n        var alreadyExists = pc.getSenders().find(function(s) {\n          return s.track === track;\n        });\n        if (alreadyExists) {\n          throw new DOMException('Track already exists.',\n              'InvalidAccessError');\n        }\n      });\n      // Add identity mapping for consistency with addTrack.\n      // Unless this is being used with a stream from addTrack.\n      if (!pc._reverseStreams[stream.id]) {\n        var newStream = new window.MediaStream(stream.getTracks());\n        pc._streams[stream.id] = newStream;\n        pc._reverseStreams[newStream.id] = stream;\n        stream = newStream;\n      }\n      origAddStream.apply(pc, [stream]);\n    };\n\n    var origRemoveStream = window.RTCPeerConnection.prototype.removeStream;\n    window.RTCPeerConnection.prototype.removeStream = function(stream) {\n      var pc = this;\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n\n      origRemoveStream.apply(pc, [(pc._streams[stream.id] || stream)]);\n      delete pc._reverseStreams[(pc._streams[stream.id] ?\n          pc._streams[stream.id].id : stream.id)];\n      delete pc._streams[stream.id];\n    };\n\n    window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n      var pc = this;\n      if (pc.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      var streams = [].slice.call(arguments, 1);\n      if (streams.length !== 1 ||\n          !streams[0].getTracks().find(function(t) {\n            return t === track;\n          })) {\n        // this is not fully correct but all we can manage without\n        // [[associated MediaStreams]] internal slot.\n        throw new DOMException(\n          'The adapter.js addTrack polyfill only supports a single ' +\n          ' stream which is associated with the specified track.',\n          'NotSupportedError');\n      }\n\n      var alreadyExists = pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n      if (alreadyExists) {\n        throw new DOMException('Track already exists.',\n            'InvalidAccessError');\n      }\n\n      pc._streams = pc._streams || {};\n      pc._reverseStreams = pc._reverseStreams || {};\n      var oldStream = pc._streams[stream.id];\n      if (oldStream) {\n        // this is using odd Chrome behaviour, use with caution:\n        // https://bugs.chromium.org/p/webrtc/issues/detail?id=7815\n        // Note: we rely on the high-level addTrack/dtmf shim to\n        // create the sender with a dtmf sender.\n        oldStream.addTrack(track);\n\n        // Trigger ONN async.\n        Promise.resolve().then(function() {\n          pc.dispatchEvent(new Event('negotiationneeded'));\n        });\n      } else {\n        var newStream = new window.MediaStream([track]);\n        pc._streams[stream.id] = newStream;\n        pc._reverseStreams[newStream.id] = stream;\n        pc.addStream(newStream);\n      }\n      return pc.getSenders().find(function(s) {\n        return s.track === track;\n      });\n    };\n\n    // replace the internal stream id with the external one and\n    // vice versa.\n    function replaceInternalStreamId(pc, description) {\n      var sdp = description.sdp;\n      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {\n        var externalStream = pc._reverseStreams[internalId];\n        var internalStream = pc._streams[externalStream.id];\n        sdp = sdp.replace(new RegExp(internalStream.id, 'g'),\n            externalStream.id);\n      });\n      return new RTCSessionDescription({\n        type: description.type,\n        sdp: sdp\n      });\n    }\n    function replaceExternalStreamId(pc, description) {\n      var sdp = description.sdp;\n      Object.keys(pc._reverseStreams || []).forEach(function(internalId) {\n        var externalStream = pc._reverseStreams[internalId];\n        var internalStream = pc._streams[externalStream.id];\n        sdp = sdp.replace(new RegExp(externalStream.id, 'g'),\n            internalStream.id);\n      });\n      return new RTCSessionDescription({\n        type: description.type,\n        sdp: sdp\n      });\n    }\n    ['createOffer', 'createAnswer'].forEach(function(method) {\n      var nativeMethod = window.RTCPeerConnection.prototype[method];\n      window.RTCPeerConnection.prototype[method] = function() {\n        var pc = this;\n        var args = arguments;\n        var isLegacyCall = arguments.length &&\n            typeof arguments[0] === 'function';\n        if (isLegacyCall) {\n          return nativeMethod.apply(pc, [\n            function(description) {\n              var desc = replaceInternalStreamId(pc, description);\n              args[0].apply(null, [desc]);\n            },\n            function(err) {\n              if (args[1]) {\n                args[1].apply(null, err);\n              }\n            }, arguments[2]\n          ]);\n        }\n        return nativeMethod.apply(pc, arguments)\n        .then(function(description) {\n          return replaceInternalStreamId(pc, description);\n        });\n      };\n    });\n\n    var origSetLocalDescription =\n        window.RTCPeerConnection.prototype.setLocalDescription;\n    window.RTCPeerConnection.prototype.setLocalDescription = function() {\n      var pc = this;\n      if (!arguments.length || !arguments[0].type) {\n        return origSetLocalDescription.apply(pc, arguments);\n      }\n      arguments[0] = replaceExternalStreamId(pc, arguments[0]);\n      return origSetLocalDescription.apply(pc, arguments);\n    };\n\n    // TODO: mangle getStats: https://w3c.github.io/webrtc-stats/#dom-rtcmediastreamstats-streamidentifier\n\n    var origLocalDescription = Object.getOwnPropertyDescriptor(\n        window.RTCPeerConnection.prototype, 'localDescription');\n    Object.defineProperty(window.RTCPeerConnection.prototype,\n        'localDescription', {\n          get: function() {\n            var pc = this;\n            var description = origLocalDescription.get.apply(this);\n            if (description.type === '') {\n              return description;\n            }\n            return replaceInternalStreamId(pc, description);\n          }\n        });\n\n    window.RTCPeerConnection.prototype.removeTrack = function(sender) {\n      var pc = this;\n      if (pc.signalingState === 'closed') {\n        throw new DOMException(\n          'The RTCPeerConnection\\'s signalingState is \\'closed\\'.',\n          'InvalidStateError');\n      }\n      // We can not yet check for sender instanceof RTCRtpSender\n      // since we shim RTPSender. So we check if sender._pc is set.\n      if (!sender._pc) {\n        throw new DOMException('Argument 1 of RTCPeerConnection.removeTrack ' +\n            'does not implement interface RTCRtpSender.', 'TypeError');\n      }\n      var isLocal = sender._pc === pc;\n      if (!isLocal) {\n        throw new DOMException('Sender was not created by this connection.',\n            'InvalidAccessError');\n      }\n\n      // Search for the native stream the senders track belongs to.\n      pc._streams = pc._streams || {};\n      var stream;\n      Object.keys(pc._streams).forEach(function(streamid) {\n        var hasTrack = pc._streams[streamid].getTracks().find(function(track) {\n          return sender.track === track;\n        });\n        if (hasTrack) {\n          stream = pc._streams[streamid];\n        }\n      });\n\n      if (stream) {\n        if (stream.getTracks().length === 1) {\n          // if this is the last track of the stream, remove the stream. This\n          // takes care of any shimmed _senders.\n          pc.removeStream(pc._reverseStreams[stream.id]);\n        } else {\n          // relying on the same odd chrome behaviour as above.\n          stream.removeTrack(sender.track);\n        }\n        pc.dispatchEvent(new Event('negotiationneeded'));\n      }\n    };\n  },\n\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        // Translate iceTransportPolicy to iceTransports,\n        // see https://code.google.com/p/webrtc/issues/detail?id=4869\n        // this was fixed in M56 along with unprefixing RTCPeerConnection.\n        logging('PeerConnection');\n        if (pcConfig && pcConfig.iceTransportPolicy) {\n          pcConfig.iceTransports = pcConfig.iceTransportPolicy;\n        }\n\n        return new window.webkitRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype =\n          window.webkitRTCPeerConnection.prototype;\n      // wrap static methods. Currently just generateCertificate.\n      if (window.webkitRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return window.webkitRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n    } else {\n      // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n      var OrigPeerConnection = window.RTCPeerConnection;\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (pcConfig && pcConfig.iceServers) {\n          var newIceServers = [];\n          for (var i = 0; i < pcConfig.iceServers.length; i++) {\n            var server = pcConfig.iceServers[i];\n            if (!server.hasOwnProperty('urls') &&\n                server.hasOwnProperty('url')) {\n              utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n              server = JSON.parse(JSON.stringify(server));\n              server.urls = server.url;\n              newIceServers.push(server);\n            } else {\n              newIceServers.push(pcConfig.iceServers[i]);\n            }\n          }\n          pcConfig.iceServers = newIceServers;\n        }\n        return new OrigPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n      // wrap static methods. Currently just generateCertificate.\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n\n    var origGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function(selector,\n        successCallback, errorCallback) {\n      var self = this;\n      var args = arguments;\n\n      // If selector is a function then we are in the old style stats so just\n      // pass back the original getStats format to avoid breaking old users.\n      if (arguments.length > 0 && typeof selector === 'function') {\n        return origGetStats.apply(this, arguments);\n      }\n\n      // When spec-style getStats is supported, return those when called with\n      // either no arguments or the selector argument is null.\n      if (origGetStats.length === 0 && (arguments.length === 0 ||\n          typeof arguments[0] !== 'function')) {\n        return origGetStats.apply(this, []);\n      }\n\n      var fixChromeStats_ = function(response) {\n        var standardReport = {};\n        var reports = response.result();\n        reports.forEach(function(report) {\n          var standardStats = {\n            id: report.id,\n            timestamp: report.timestamp,\n            type: {\n              localcandidate: 'local-candidate',\n              remotecandidate: 'remote-candidate'\n            }[report.type] || report.type\n          };\n          report.names().forEach(function(name) {\n            standardStats[name] = report.stat(name);\n          });\n          standardReport[standardStats.id] = standardStats;\n        });\n\n        return standardReport;\n      };\n\n      // shim getStats with maplike support\n      var makeMapStats = function(stats) {\n        return new Map(Object.keys(stats).map(function(key) {\n          return [key, stats[key]];\n        }));\n      };\n\n      if (arguments.length >= 2) {\n        var successCallbackWrapper_ = function(response) {\n          args[1](makeMapStats(fixChromeStats_(response)));\n        };\n\n        return origGetStats.apply(this, [successCallbackWrapper_,\n          arguments[0]]);\n      }\n\n      // promise-support\n      return new Promise(function(resolve, reject) {\n        origGetStats.apply(self, [\n          function(response) {\n            resolve(makeMapStats(fixChromeStats_(response)));\n          }, reject]);\n      }).then(successCallback, errorCallback);\n    };\n\n    // add promise support -- natively available in Chrome 51\n    if (browserDetails.version < 51) {\n      ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n          .forEach(function(method) {\n            var nativeMethod = window.RTCPeerConnection.prototype[method];\n            window.RTCPeerConnection.prototype[method] = function() {\n              var args = arguments;\n              var self = this;\n              var promise = new Promise(function(resolve, reject) {\n                nativeMethod.apply(self, [args[0], resolve, reject]);\n              });\n              if (args.length < 2) {\n                return promise;\n              }\n              return promise.then(function() {\n                args[1].apply(null, []);\n              },\n              function(err) {\n                if (args.length >= 3) {\n                  args[2].apply(null, [err]);\n                }\n              });\n            };\n          });\n    }\n\n    // promise support for createOffer and createAnswer. Available (without\n    // bugs) since M52: crbug/619289\n    if (browserDetails.version < 52) {\n      ['createOffer', 'createAnswer'].forEach(function(method) {\n        var nativeMethod = window.RTCPeerConnection.prototype[method];\n        window.RTCPeerConnection.prototype[method] = function() {\n          var self = this;\n          if (arguments.length < 1 || (arguments.length === 1 &&\n              typeof arguments[0] === 'object')) {\n            var opts = arguments.length === 1 ? arguments[0] : undefined;\n            return new Promise(function(resolve, reject) {\n              nativeMethod.apply(self, [resolve, reject, opts]);\n            });\n          }\n          return nativeMethod.apply(this, arguments);\n        };\n      });\n    }\n\n    // shim implicit creation of RTCSessionDescription/RTCIceCandidate\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\n          window.RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n  }\n};\n\n\n// Expose public methods.\nmodule.exports = {\n  shimMediaStream: chromeShim.shimMediaStream,\n  shimOnTrack: chromeShim.shimOnTrack,\n  shimAddTrackRemoveTrack: chromeShim.shimAddTrackRemoveTrack,\n  shimGetSendersWithDtmf: chromeShim.shimGetSendersWithDtmf,\n  shimSourceObject: chromeShim.shimSourceObject,\n  shimPeerConnection: chromeShim.shimPeerConnection,\n  shimGetUserMedia: require('./getusermedia')\n};\n\n},{\"../utils.js\":13,\"./getusermedia\":6}],6:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\nvar utils = require('../utils.js');\nvar logging = utils.log;\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n\n  var constraintsToChrome_ = function(c) {\n    if (typeof c !== 'object' || c.mandatory || c.optional) {\n      return c;\n    }\n    var cc = {};\n    Object.keys(c).forEach(function(key) {\n      if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n        return;\n      }\n      var r = (typeof c[key] === 'object') ? c[key] : {ideal: c[key]};\n      if (r.exact !== undefined && typeof r.exact === 'number') {\n        r.min = r.max = r.exact;\n      }\n      var oldname_ = function(prefix, name) {\n        if (prefix) {\n          return prefix + name.charAt(0).toUpperCase() + name.slice(1);\n        }\n        return (name === 'deviceId') ? 'sourceId' : name;\n      };\n      if (r.ideal !== undefined) {\n        cc.optional = cc.optional || [];\n        var oc = {};\n        if (typeof r.ideal === 'number') {\n          oc[oldname_('min', key)] = r.ideal;\n          cc.optional.push(oc);\n          oc = {};\n          oc[oldname_('max', key)] = r.ideal;\n          cc.optional.push(oc);\n        } else {\n          oc[oldname_('', key)] = r.ideal;\n          cc.optional.push(oc);\n        }\n      }\n      if (r.exact !== undefined && typeof r.exact !== 'number') {\n        cc.mandatory = cc.mandatory || {};\n        cc.mandatory[oldname_('', key)] = r.exact;\n      } else {\n        ['min', 'max'].forEach(function(mix) {\n          if (r[mix] !== undefined) {\n            cc.mandatory = cc.mandatory || {};\n            cc.mandatory[oldname_(mix, key)] = r[mix];\n          }\n        });\n      }\n    });\n    if (c.advanced) {\n      cc.optional = (cc.optional || []).concat(c.advanced);\n    }\n    return cc;\n  };\n\n  var shimConstraints_ = function(constraints, func) {\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (constraints && typeof constraints.audio === 'object') {\n      var remap = function(obj, a, b) {\n        if (a in obj && !(b in obj)) {\n          obj[b] = obj[a];\n          delete obj[a];\n        }\n      };\n      constraints = JSON.parse(JSON.stringify(constraints));\n      remap(constraints.audio, 'autoGainControl', 'googAutoGainControl');\n      remap(constraints.audio, 'noiseSuppression', 'googNoiseSuppression');\n      constraints.audio = constraintsToChrome_(constraints.audio);\n    }\n    if (constraints && typeof constraints.video === 'object') {\n      // Shim facingMode for mobile & surface pro.\n      var face = constraints.video.facingMode;\n      face = face && ((typeof face === 'object') ? face : {ideal: face});\n      var getSupportedFacingModeLies = browserDetails.version < 66;\n\n      if ((face && (face.exact === 'user' || face.exact === 'environment' ||\n                    face.ideal === 'user' || face.ideal === 'environment')) &&\n          !(navigator.mediaDevices.getSupportedConstraints &&\n            navigator.mediaDevices.getSupportedConstraints().facingMode &&\n            !getSupportedFacingModeLies)) {\n        delete constraints.video.facingMode;\n        var matches;\n        if (face.exact === 'environment' || face.ideal === 'environment') {\n          matches = ['back', 'rear'];\n        } else if (face.exact === 'user' || face.ideal === 'user') {\n          matches = ['front'];\n        }\n        if (matches) {\n          // Look for matches in label, or use last cam for back (typical).\n          return navigator.mediaDevices.enumerateDevices()\n          .then(function(devices) {\n            devices = devices.filter(function(d) {\n              return d.kind === 'videoinput';\n            });\n            var dev = devices.find(function(d) {\n              return matches.some(function(match) {\n                return d.label.toLowerCase().indexOf(match) !== -1;\n              });\n            });\n            if (!dev && devices.length && matches.indexOf('back') !== -1) {\n              dev = devices[devices.length - 1]; // more likely the back cam\n            }\n            if (dev) {\n              constraints.video.deviceId = face.exact ? {exact: dev.deviceId} :\n                                                        {ideal: dev.deviceId};\n            }\n            constraints.video = constraintsToChrome_(constraints.video);\n            logging('chrome: ' + JSON.stringify(constraints));\n            return func(constraints);\n          });\n        }\n      }\n      constraints.video = constraintsToChrome_(constraints.video);\n    }\n    logging('chrome: ' + JSON.stringify(constraints));\n    return func(constraints);\n  };\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        PermissionDeniedError: 'NotAllowedError',\n        InvalidStateError: 'NotReadableError',\n        DevicesNotFoundError: 'NotFoundError',\n        ConstraintNotSatisfiedError: 'OverconstrainedError',\n        TrackStartError: 'NotReadableError',\n        MediaDeviceFailedDueToShutdown: 'NotReadableError',\n        MediaDeviceKillSwitchOn: 'NotReadableError'\n      }[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraintName,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    shimConstraints_(constraints, function(c) {\n      navigator.webkitGetUserMedia(c, onSuccess, function(e) {\n        if (onError) {\n          onError(shimError_(e));\n        }\n      });\n    });\n  };\n\n  navigator.getUserMedia = getUserMedia_;\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      navigator.getUserMedia(constraints, resolve, reject);\n    });\n  };\n\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {\n      getUserMedia: getUserMediaPromise_,\n      enumerateDevices: function() {\n        return new Promise(function(resolve) {\n          var kinds = {audio: 'audioinput', video: 'videoinput'};\n          return window.MediaStreamTrack.getSources(function(devices) {\n            resolve(devices.map(function(device) {\n              return {label: device.label,\n                kind: kinds[device.kind],\n                deviceId: device.id,\n                groupId: ''};\n            }));\n          });\n        });\n      },\n      getSupportedConstraints: function() {\n        return {\n          deviceId: true, echoCancellation: true, facingMode: true,\n          frameRate: true, height: true, width: true\n        };\n      }\n    };\n  }\n\n  // A shim for getUserMedia method on the mediaDevices object.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (!navigator.mediaDevices.getUserMedia) {\n    navigator.mediaDevices.getUserMedia = function(constraints) {\n      return getUserMediaPromise_(constraints);\n    };\n  } else {\n    // Even though Chrome 45 has navigator.mediaDevices and a getUserMedia\n    // function which returns a Promise, it does not accept spec-style\n    // constraints.\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(cs) {\n      return shimConstraints_(cs, function(c) {\n        return origGetUserMedia(c).then(function(stream) {\n          if (c.audio && !stream.getAudioTracks().length ||\n              c.video && !stream.getVideoTracks().length) {\n            stream.getTracks().forEach(function(track) {\n              track.stop();\n            });\n            throw new DOMException('', 'NotFoundError');\n          }\n          return stream;\n        }, function(e) {\n          return Promise.reject(shimError_(e));\n        });\n      });\n    };\n  }\n\n  // Dummy devicechange event methods.\n  // TODO(KaptenJansson) remove once implemented in Chrome stable.\n  if (typeof navigator.mediaDevices.addEventListener === 'undefined') {\n    navigator.mediaDevices.addEventListener = function() {\n      logging('Dummy mediaDevices.addEventListener called.');\n    };\n  }\n  if (typeof navigator.mediaDevices.removeEventListener === 'undefined') {\n    navigator.mediaDevices.removeEventListener = function() {\n      logging('Dummy mediaDevices.removeEventListener called.');\n    };\n  }\n};\n\n},{\"../utils.js\":13}],7:[function(require,module,exports){\n/*\n *  Copyright (c) 2017 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar SDPUtils = require('sdp');\nvar utils = require('./utils');\n\n// Wraps the peerconnection event eventNameToWrap in a function\n// which returns the modified event object.\nfunction wrapPeerConnectionEvent(window, eventNameToWrap, wrapper) {\n  if (!window.RTCPeerConnection) {\n    return;\n  }\n  var proto = window.RTCPeerConnection.prototype;\n  var nativeAddEventListener = proto.addEventListener;\n  proto.addEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap) {\n      return nativeAddEventListener.apply(this, arguments);\n    }\n    var wrappedCallback = function(e) {\n      cb(wrapper(e));\n    };\n    this._eventMap = this._eventMap || {};\n    this._eventMap[cb] = wrappedCallback;\n    return nativeAddEventListener.apply(this, [nativeEventName,\n      wrappedCallback]);\n  };\n\n  var nativeRemoveEventListener = proto.removeEventListener;\n  proto.removeEventListener = function(nativeEventName, cb) {\n    if (nativeEventName !== eventNameToWrap || !this._eventMap\n        || !this._eventMap[cb]) {\n      return nativeRemoveEventListener.apply(this, arguments);\n    }\n    var unwrappedCb = this._eventMap[cb];\n    delete this._eventMap[cb];\n    return nativeRemoveEventListener.apply(this, [nativeEventName,\n      unwrappedCb]);\n  };\n\n  Object.defineProperty(proto, 'on' + eventNameToWrap, {\n    get: function() {\n      return this['_on' + eventNameToWrap];\n    },\n    set: function(cb) {\n      if (this['_on' + eventNameToWrap]) {\n        this.removeEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap]);\n        delete this['_on' + eventNameToWrap];\n      }\n      if (cb) {\n        this.addEventListener(eventNameToWrap,\n            this['_on' + eventNameToWrap] = cb);\n      }\n    }\n  });\n}\n\nmodule.exports = {\n  shimRTCIceCandidate: function(window) {\n    // foundation is arbitrarily chosen as an indicator for full support for\n    // https://w3c.github.io/webrtc-pc/#rtcicecandidate-interface\n    if (window.RTCIceCandidate && 'foundation' in\n        window.RTCIceCandidate.prototype) {\n      return;\n    }\n\n    var NativeRTCIceCandidate = window.RTCIceCandidate;\n    window.RTCIceCandidate = function(args) {\n      // Remove the a= which shouldn't be part of the candidate string.\n      if (typeof args === 'object' && args.candidate &&\n          args.candidate.indexOf('a=') === 0) {\n        args = JSON.parse(JSON.stringify(args));\n        args.candidate = args.candidate.substr(2);\n      }\n\n      // Augment the native candidate with the parsed fields.\n      var nativeCandidate = new NativeRTCIceCandidate(args);\n      var parsedCandidate = SDPUtils.parseCandidate(args.candidate);\n      var augmentedCandidate = Object.assign(nativeCandidate,\n          parsedCandidate);\n\n      // Add a serializer that does not serialize the extra attributes.\n      augmentedCandidate.toJSON = function() {\n        return {\n          candidate: augmentedCandidate.candidate,\n          sdpMid: augmentedCandidate.sdpMid,\n          sdpMLineIndex: augmentedCandidate.sdpMLineIndex,\n          usernameFragment: augmentedCandidate.usernameFragment,\n        };\n      };\n      return augmentedCandidate;\n    };\n\n    // Hook up the augmented candidate in onicecandidate and\n    // addEventListener('icecandidate', ...)\n    wrapPeerConnectionEvent(window, 'icecandidate', function(e) {\n      if (e.candidate) {\n        Object.defineProperty(e, 'candidate', {\n          value: new window.RTCIceCandidate(e.candidate),\n          writable: 'false'\n        });\n      }\n      return e;\n    });\n  },\n\n  // shimCreateObjectURL must be called before shimSourceObject to avoid loop.\n\n  shimCreateObjectURL: function(window) {\n    var URL = window && window.URL;\n\n    if (!(typeof window === 'object' && window.HTMLMediaElement &&\n          'srcObject' in window.HTMLMediaElement.prototype &&\n        URL.createObjectURL && URL.revokeObjectURL)) {\n      // Only shim CreateObjectURL using srcObject if srcObject exists.\n      return undefined;\n    }\n\n    var nativeCreateObjectURL = URL.createObjectURL.bind(URL);\n    var nativeRevokeObjectURL = URL.revokeObjectURL.bind(URL);\n    var streams = new Map(), newId = 0;\n\n    URL.createObjectURL = function(stream) {\n      if ('getTracks' in stream) {\n        var url = 'polyblob:' + (++newId);\n        streams.set(url, stream);\n        utils.deprecated('URL.createObjectURL(stream)',\n            'elem.srcObject = stream');\n        return url;\n      }\n      return nativeCreateObjectURL(stream);\n    };\n    URL.revokeObjectURL = function(url) {\n      nativeRevokeObjectURL(url);\n      streams.delete(url);\n    };\n\n    var dsc = Object.getOwnPropertyDescriptor(window.HTMLMediaElement.prototype,\n                                              'src');\n    Object.defineProperty(window.HTMLMediaElement.prototype, 'src', {\n      get: function() {\n        return dsc.get.apply(this);\n      },\n      set: function(url) {\n        this.srcObject = streams.get(url) || null;\n        return dsc.set.apply(this, [url]);\n      }\n    });\n\n    var nativeSetAttribute = window.HTMLMediaElement.prototype.setAttribute;\n    window.HTMLMediaElement.prototype.setAttribute = function() {\n      if (arguments.length === 2 &&\n          ('' + arguments[0]).toLowerCase() === 'src') {\n        this.srcObject = streams.get(arguments[1]) || null;\n      }\n      return nativeSetAttribute.apply(this, arguments);\n    };\n  }\n};\n\n},{\"./utils\":13,\"sdp\":2}],8:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\nvar shimRTCPeerConnection = require('rtcpeerconnection-shim');\n\nmodule.exports = {\n  shimGetUserMedia: require('./getusermedia'),\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (window.RTCIceGatherer) {\n      // ORTC defines an RTCIceCandidate object but no constructor.\n      // Not implemented in Edge.\n      if (!window.RTCIceCandidate) {\n        window.RTCIceCandidate = function(args) {\n          return args;\n        };\n      }\n      // ORTC does not have a session description object but\n      // other browsers (i.e. Chrome) that will support both PC and ORTC\n      // in the future might have this defined already.\n      if (!window.RTCSessionDescription) {\n        window.RTCSessionDescription = function(args) {\n          return args;\n        };\n      }\n      // this adds an additional event listener to MediaStrackTrack that signals\n      // when a tracks enabled property was changed. Workaround for a bug in\n      // addStream, see below. No longer required in 15025+\n      if (browserDetails.version < 15025) {\n        var origMSTEnabled = Object.getOwnPropertyDescriptor(\n            window.MediaStreamTrack.prototype, 'enabled');\n        Object.defineProperty(window.MediaStreamTrack.prototype, 'enabled', {\n          set: function(value) {\n            origMSTEnabled.set.call(this, value);\n            var ev = new Event('enabled');\n            ev.enabled = value;\n            this.dispatchEvent(ev);\n          }\n        });\n      }\n    }\n\n    // ORTC defines the DTMF sender a bit different.\n    // https://github.com/w3c/ortc/issues/714\n    if (window.RTCRtpSender && !('dtmf' in window.RTCRtpSender.prototype)) {\n      Object.defineProperty(window.RTCRtpSender.prototype, 'dtmf', {\n        get: function() {\n          if (this._dtmf === undefined) {\n            if (this.track.kind === 'audio') {\n              this._dtmf = new window.RTCDtmfSender(this);\n            } else if (this.track.kind === 'video') {\n              this._dtmf = null;\n            }\n          }\n          return this._dtmf;\n        }\n      });\n    }\n\n    window.RTCPeerConnection =\n        shimRTCPeerConnection(window, browserDetails.version);\n  },\n  shimReplaceTrack: function(window) {\n    // ORTC has replaceTrack -- https://github.com/w3c/ortc/issues/614\n    if (window.RTCRtpSender &&\n        !('replaceTrack' in window.RTCRtpSender.prototype)) {\n      window.RTCRtpSender.prototype.replaceTrack =\n          window.RTCRtpSender.prototype.setTrack;\n    }\n  }\n};\n\n},{\"../utils\":13,\"./getusermedia\":9,\"rtcpeerconnection-shim\":1}],9:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var navigator = window && window.navigator;\n\n  var shimError_ = function(e) {\n    return {\n      name: {PermissionDeniedError: 'NotAllowedError'}[e.name] || e.name,\n      message: e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name;\n      }\n    };\n  };\n\n  // getUserMedia error shim.\n  var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n      bind(navigator.mediaDevices);\n  navigator.mediaDevices.getUserMedia = function(c) {\n    return origGetUserMedia(c).catch(function(e) {\n      return Promise.reject(shimError_(e));\n    });\n  };\n};\n\n},{}],10:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\n\nvar firefoxShim = {\n  shimOnTrack: function(window) {\n    if (typeof window === 'object' && window.RTCPeerConnection && !('ontrack' in\n        window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'ontrack', {\n        get: function() {\n          return this._ontrack;\n        },\n        set: function(f) {\n          if (this._ontrack) {\n            this.removeEventListener('track', this._ontrack);\n            this.removeEventListener('addstream', this._ontrackpoly);\n          }\n          this.addEventListener('track', this._ontrack = f);\n          this.addEventListener('addstream', this._ontrackpoly = function(e) {\n            e.stream.getTracks().forEach(function(track) {\n              var event = new Event('track');\n              event.track = track;\n              event.receiver = {track: track};\n              event.transceiver = {receiver: event.receiver};\n              event.streams = [e.stream];\n              this.dispatchEvent(event);\n            }.bind(this));\n          }.bind(this));\n        }\n      });\n    }\n    if (typeof window === 'object' && window.RTCTrackEvent &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        !('transceiver' in window.RTCTrackEvent.prototype)) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimSourceObject: function(window) {\n    // Firefox has supported mozSrcObject since FF22, unprefixed in 42.\n    if (typeof window === 'object') {\n      if (window.HTMLMediaElement &&\n        !('srcObject' in window.HTMLMediaElement.prototype)) {\n        // Shim the srcObject property, once, when HTMLMediaElement is found.\n        Object.defineProperty(window.HTMLMediaElement.prototype, 'srcObject', {\n          get: function() {\n            return this.mozSrcObject;\n          },\n          set: function(stream) {\n            this.mozSrcObject = stream;\n          }\n        });\n      }\n    }\n  },\n\n  shimPeerConnection: function(window) {\n    var browserDetails = utils.detectBrowser(window);\n\n    if (typeof window !== 'object' || !(window.RTCPeerConnection ||\n        window.mozRTCPeerConnection)) {\n      return; // probably media.peerconnection.enabled=false in about:config\n    }\n    // The RTCPeerConnection object.\n    if (!window.RTCPeerConnection) {\n      window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n        if (browserDetails.version < 38) {\n          // .urls is not supported in FF < 38.\n          // create RTCIceServers with a single url.\n          if (pcConfig && pcConfig.iceServers) {\n            var newIceServers = [];\n            for (var i = 0; i < pcConfig.iceServers.length; i++) {\n              var server = pcConfig.iceServers[i];\n              if (server.hasOwnProperty('urls')) {\n                for (var j = 0; j < server.urls.length; j++) {\n                  var newServer = {\n                    url: server.urls[j]\n                  };\n                  if (server.urls[j].indexOf('turn') === 0) {\n                    newServer.username = server.username;\n                    newServer.credential = server.credential;\n                  }\n                  newIceServers.push(newServer);\n                }\n              } else {\n                newIceServers.push(pcConfig.iceServers[i]);\n              }\n            }\n            pcConfig.iceServers = newIceServers;\n          }\n        }\n        return new window.mozRTCPeerConnection(pcConfig, pcConstraints);\n      };\n      window.RTCPeerConnection.prototype =\n          window.mozRTCPeerConnection.prototype;\n\n      // wrap static methods. Currently just generateCertificate.\n      if (window.mozRTCPeerConnection.generateCertificate) {\n        Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n          get: function() {\n            return window.mozRTCPeerConnection.generateCertificate;\n          }\n        });\n      }\n\n      window.RTCSessionDescription = window.mozRTCSessionDescription;\n      window.RTCIceCandidate = window.mozRTCIceCandidate;\n    }\n\n    // shim away need for obsolete RTCIceCandidate/RTCSessionDescription.\n    ['setLocalDescription', 'setRemoteDescription', 'addIceCandidate']\n        .forEach(function(method) {\n          var nativeMethod = window.RTCPeerConnection.prototype[method];\n          window.RTCPeerConnection.prototype[method] = function() {\n            arguments[0] = new ((method === 'addIceCandidate') ?\n                window.RTCIceCandidate :\n                window.RTCSessionDescription)(arguments[0]);\n            return nativeMethod.apply(this, arguments);\n          };\n        });\n\n    // support for addIceCandidate(null or undefined)\n    var nativeAddIceCandidate =\n        window.RTCPeerConnection.prototype.addIceCandidate;\n    window.RTCPeerConnection.prototype.addIceCandidate = function() {\n      if (!arguments[0]) {\n        if (arguments[1]) {\n          arguments[1].apply(null);\n        }\n        return Promise.resolve();\n      }\n      return nativeAddIceCandidate.apply(this, arguments);\n    };\n\n    // shim getStats with maplike support\n    var makeMapStats = function(stats) {\n      var map = new Map();\n      Object.keys(stats).forEach(function(key) {\n        map.set(key, stats[key]);\n        map[key] = stats[key];\n      });\n      return map;\n    };\n\n    var modernStatsTypes = {\n      inboundrtp: 'inbound-rtp',\n      outboundrtp: 'outbound-rtp',\n      candidatepair: 'candidate-pair',\n      localcandidate: 'local-candidate',\n      remotecandidate: 'remote-candidate'\n    };\n\n    var nativeGetStats = window.RTCPeerConnection.prototype.getStats;\n    window.RTCPeerConnection.prototype.getStats = function(\n      selector,\n      onSucc,\n      onErr\n    ) {\n      return nativeGetStats.apply(this, [selector || null])\n        .then(function(stats) {\n          if (browserDetails.version < 48) {\n            stats = makeMapStats(stats);\n          }\n          if (browserDetails.version < 53 && !onSucc) {\n            // Shim only promise getStats with spec-hyphens in type names\n            // Leave callback version alone; misc old uses of forEach before Map\n            try {\n              stats.forEach(function(stat) {\n                stat.type = modernStatsTypes[stat.type] || stat.type;\n              });\n            } catch (e) {\n              if (e.name !== 'TypeError') {\n                throw e;\n              }\n              // Avoid TypeError: \"type\" is read-only, in old versions. 34-43ish\n              stats.forEach(function(stat, i) {\n                stats.set(i, Object.assign({}, stat, {\n                  type: modernStatsTypes[stat.type] || stat.type\n                }));\n              });\n            }\n          }\n          return stats;\n        })\n        .then(onSucc, onErr);\n    };\n  }\n};\n\n// Expose public methods.\nmodule.exports = {\n  shimOnTrack: firefoxShim.shimOnTrack,\n  shimSourceObject: firefoxShim.shimSourceObject,\n  shimPeerConnection: firefoxShim.shimPeerConnection,\n  shimGetUserMedia: require('./getusermedia')\n};\n\n},{\"../utils\":13,\"./getusermedia\":11}],11:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar utils = require('../utils');\nvar logging = utils.log;\n\n// Expose public methods.\nmodule.exports = function(window) {\n  var browserDetails = utils.detectBrowser(window);\n  var navigator = window && window.navigator;\n  var MediaStreamTrack = window && window.MediaStreamTrack;\n\n  var shimError_ = function(e) {\n    return {\n      name: {\n        InternalError: 'NotReadableError',\n        NotSupportedError: 'TypeError',\n        PermissionDeniedError: 'NotAllowedError',\n        SecurityError: 'NotAllowedError'\n      }[e.name] || e.name,\n      message: {\n        'The operation is insecure.': 'The request is not allowed by the ' +\n        'user agent or the platform in the current context.'\n      }[e.message] || e.message,\n      constraint: e.constraint,\n      toString: function() {\n        return this.name + (this.message && ': ') + this.message;\n      }\n    };\n  };\n\n  // getUserMedia constraints shim.\n  var getUserMedia_ = function(constraints, onSuccess, onError) {\n    var constraintsToFF37_ = function(c) {\n      if (typeof c !== 'object' || c.require) {\n        return c;\n      }\n      var require = [];\n      Object.keys(c).forEach(function(key) {\n        if (key === 'require' || key === 'advanced' || key === 'mediaSource') {\n          return;\n        }\n        var r = c[key] = (typeof c[key] === 'object') ?\n            c[key] : {ideal: c[key]};\n        if (r.min !== undefined ||\n            r.max !== undefined || r.exact !== undefined) {\n          require.push(key);\n        }\n        if (r.exact !== undefined) {\n          if (typeof r.exact === 'number') {\n            r. min = r.max = r.exact;\n          } else {\n            c[key] = r.exact;\n          }\n          delete r.exact;\n        }\n        if (r.ideal !== undefined) {\n          c.advanced = c.advanced || [];\n          var oc = {};\n          if (typeof r.ideal === 'number') {\n            oc[key] = {min: r.ideal, max: r.ideal};\n          } else {\n            oc[key] = r.ideal;\n          }\n          c.advanced.push(oc);\n          delete r.ideal;\n          if (!Object.keys(r).length) {\n            delete c[key];\n          }\n        }\n      });\n      if (require.length) {\n        c.require = require;\n      }\n      return c;\n    };\n    constraints = JSON.parse(JSON.stringify(constraints));\n    if (browserDetails.version < 38) {\n      logging('spec: ' + JSON.stringify(constraints));\n      if (constraints.audio) {\n        constraints.audio = constraintsToFF37_(constraints.audio);\n      }\n      if (constraints.video) {\n        constraints.video = constraintsToFF37_(constraints.video);\n      }\n      logging('ff37: ' + JSON.stringify(constraints));\n    }\n    return navigator.mozGetUserMedia(constraints, onSuccess, function(e) {\n      onError(shimError_(e));\n    });\n  };\n\n  // Returns the result of getUserMedia as a Promise.\n  var getUserMediaPromise_ = function(constraints) {\n    return new Promise(function(resolve, reject) {\n      getUserMedia_(constraints, resolve, reject);\n    });\n  };\n\n  // Shim for mediaDevices on older versions.\n  if (!navigator.mediaDevices) {\n    navigator.mediaDevices = {getUserMedia: getUserMediaPromise_,\n      addEventListener: function() { },\n      removeEventListener: function() { }\n    };\n  }\n  navigator.mediaDevices.enumerateDevices =\n      navigator.mediaDevices.enumerateDevices || function() {\n        return new Promise(function(resolve) {\n          var infos = [\n            {kind: 'audioinput', deviceId: 'default', label: '', groupId: ''},\n            {kind: 'videoinput', deviceId: 'default', label: '', groupId: ''}\n          ];\n          resolve(infos);\n        });\n      };\n\n  if (browserDetails.version < 41) {\n    // Work around http://bugzil.la/1169665\n    var orgEnumerateDevices =\n        navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);\n    navigator.mediaDevices.enumerateDevices = function() {\n      return orgEnumerateDevices().then(undefined, function(e) {\n        if (e.name === 'NotFoundError') {\n          return [];\n        }\n        throw e;\n      });\n    };\n  }\n  if (browserDetails.version < 49) {\n    var origGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      return origGetUserMedia(c).then(function(stream) {\n        // Work around https://bugzil.la/802326\n        if (c.audio && !stream.getAudioTracks().length ||\n            c.video && !stream.getVideoTracks().length) {\n          stream.getTracks().forEach(function(track) {\n            track.stop();\n          });\n          throw new DOMException('The object can not be found here.',\n                                 'NotFoundError');\n        }\n        return stream;\n      }, function(e) {\n        return Promise.reject(shimError_(e));\n      });\n    };\n  }\n  if (!(browserDetails.version > 55 &&\n      'autoGainControl' in navigator.mediaDevices.getSupportedConstraints())) {\n    var remap = function(obj, a, b) {\n      if (a in obj && !(b in obj)) {\n        obj[b] = obj[a];\n        delete obj[a];\n      }\n    };\n\n    var nativeGetUserMedia = navigator.mediaDevices.getUserMedia.\n        bind(navigator.mediaDevices);\n    navigator.mediaDevices.getUserMedia = function(c) {\n      if (typeof c === 'object' && typeof c.audio === 'object') {\n        c = JSON.parse(JSON.stringify(c));\n        remap(c.audio, 'autoGainControl', 'mozAutoGainControl');\n        remap(c.audio, 'noiseSuppression', 'mozNoiseSuppression');\n      }\n      return nativeGetUserMedia(c);\n    };\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.getSettings) {\n      var nativeGetSettings = MediaStreamTrack.prototype.getSettings;\n      MediaStreamTrack.prototype.getSettings = function() {\n        var obj = nativeGetSettings.apply(this, arguments);\n        remap(obj, 'mozAutoGainControl', 'autoGainControl');\n        remap(obj, 'mozNoiseSuppression', 'noiseSuppression');\n        return obj;\n      };\n    }\n\n    if (MediaStreamTrack && MediaStreamTrack.prototype.applyConstraints) {\n      var nativeApplyConstraints = MediaStreamTrack.prototype.applyConstraints;\n      MediaStreamTrack.prototype.applyConstraints = function(c) {\n        if (this.kind === 'audio' && typeof c === 'object') {\n          c = JSON.parse(JSON.stringify(c));\n          remap(c, 'autoGainControl', 'mozAutoGainControl');\n          remap(c, 'noiseSuppression', 'mozNoiseSuppression');\n        }\n        return nativeApplyConstraints.apply(this, [c]);\n      };\n    }\n  }\n  navigator.getUserMedia = function(constraints, onSuccess, onError) {\n    if (browserDetails.version < 44) {\n      return getUserMedia_(constraints, onSuccess, onError);\n    }\n    // Replace Firefox 44+'s deprecation warning with unprefixed version.\n    utils.deprecated('navigator.getUserMedia',\n        'navigator.mediaDevices.getUserMedia');\n    navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n  };\n};\n\n},{\"../utils\":13}],12:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n'use strict';\nvar utils = require('../utils');\n\nvar safariShim = {\n  // TODO: DrAlex, should be here, double check against LayoutTests\n\n  // TODO: once the back-end for the mac port is done, add.\n  // TODO: check for webkitGTK+\n  // shimPeerConnection: function() { },\n\n  shimLocalStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getLocalStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getLocalStreams = function() {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        return this._localStreams;\n      };\n    }\n    if (!('getStreamById' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getStreamById = function(id) {\n        var result = null;\n        if (this._localStreams) {\n          this._localStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        if (this._remoteStreams) {\n          this._remoteStreams.forEach(function(stream) {\n            if (stream.id === id) {\n              result = stream;\n            }\n          });\n        }\n        return result;\n      };\n    }\n    if (!('addStream' in window.RTCPeerConnection.prototype)) {\n      var _addTrack = window.RTCPeerConnection.prototype.addTrack;\n      window.RTCPeerConnection.prototype.addStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        if (this._localStreams.indexOf(stream) === -1) {\n          this._localStreams.push(stream);\n        }\n        var self = this;\n        stream.getTracks().forEach(function(track) {\n          _addTrack.call(self, track, stream);\n        });\n      };\n\n      window.RTCPeerConnection.prototype.addTrack = function(track, stream) {\n        if (stream) {\n          if (!this._localStreams) {\n            this._localStreams = [stream];\n          } else if (this._localStreams.indexOf(stream) === -1) {\n            this._localStreams.push(stream);\n          }\n        }\n        _addTrack.call(this, track, stream);\n      };\n    }\n    if (!('removeStream' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.removeStream = function(stream) {\n        if (!this._localStreams) {\n          this._localStreams = [];\n        }\n        var index = this._localStreams.indexOf(stream);\n        if (index === -1) {\n          return;\n        }\n        this._localStreams.splice(index, 1);\n        var self = this;\n        var tracks = stream.getTracks();\n        this.getSenders().forEach(function(sender) {\n          if (tracks.indexOf(sender.track) !== -1) {\n            self.removeTrack(sender);\n          }\n        });\n      };\n    }\n  },\n  shimRemoteStreamsAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    if (!('getRemoteStreams' in window.RTCPeerConnection.prototype)) {\n      window.RTCPeerConnection.prototype.getRemoteStreams = function() {\n        return this._remoteStreams ? this._remoteStreams : [];\n      };\n    }\n    if (!('onaddstream' in window.RTCPeerConnection.prototype)) {\n      Object.defineProperty(window.RTCPeerConnection.prototype, 'onaddstream', {\n        get: function() {\n          return this._onaddstream;\n        },\n        set: function(f) {\n          if (this._onaddstream) {\n            this.removeEventListener('addstream', this._onaddstream);\n            this.removeEventListener('track', this._onaddstreampoly);\n          }\n          this.addEventListener('addstream', this._onaddstream = f);\n          this.addEventListener('track', this._onaddstreampoly = function(e) {\n            var stream = e.streams[0];\n            if (!this._remoteStreams) {\n              this._remoteStreams = [];\n            }\n            if (this._remoteStreams.indexOf(stream) >= 0) {\n              return;\n            }\n            this._remoteStreams.push(stream);\n            var event = new Event('addstream');\n            event.stream = e.streams[0];\n            this.dispatchEvent(event);\n          }.bind(this));\n        }\n      });\n    }\n  },\n  shimCallbacksAPI: function(window) {\n    if (typeof window !== 'object' || !window.RTCPeerConnection) {\n      return;\n    }\n    var prototype = window.RTCPeerConnection.prototype;\n    var createOffer = prototype.createOffer;\n    var createAnswer = prototype.createAnswer;\n    var setLocalDescription = prototype.setLocalDescription;\n    var setRemoteDescription = prototype.setRemoteDescription;\n    var addIceCandidate = prototype.addIceCandidate;\n\n    prototype.createOffer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createOffer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    prototype.createAnswer = function(successCallback, failureCallback) {\n      var options = (arguments.length >= 2) ? arguments[2] : arguments[0];\n      var promise = createAnswer.apply(this, [options]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n\n    var withCallback = function(description, successCallback, failureCallback) {\n      var promise = setLocalDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setLocalDescription = withCallback;\n\n    withCallback = function(description, successCallback, failureCallback) {\n      var promise = setRemoteDescription.apply(this, [description]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.setRemoteDescription = withCallback;\n\n    withCallback = function(candidate, successCallback, failureCallback) {\n      var promise = addIceCandidate.apply(this, [candidate]);\n      if (!failureCallback) {\n        return promise;\n      }\n      promise.then(successCallback, failureCallback);\n      return Promise.resolve();\n    };\n    prototype.addIceCandidate = withCallback;\n  },\n  shimGetUserMedia: function(window) {\n    var navigator = window && window.navigator;\n\n    if (!navigator.getUserMedia) {\n      if (navigator.webkitGetUserMedia) {\n        navigator.getUserMedia = navigator.webkitGetUserMedia.bind(navigator);\n      } else if (navigator.mediaDevices &&\n          navigator.mediaDevices.getUserMedia) {\n        navigator.getUserMedia = function(constraints, cb, errcb) {\n          navigator.mediaDevices.getUserMedia(constraints)\n          .then(cb, errcb);\n        }.bind(navigator);\n      }\n    }\n  },\n  shimRTCIceServerUrls: function(window) {\n    // migrate from non-spec RTCIceServer.url to RTCIceServer.urls\n    var OrigPeerConnection = window.RTCPeerConnection;\n    window.RTCPeerConnection = function(pcConfig, pcConstraints) {\n      if (pcConfig && pcConfig.iceServers) {\n        var newIceServers = [];\n        for (var i = 0; i < pcConfig.iceServers.length; i++) {\n          var server = pcConfig.iceServers[i];\n          if (!server.hasOwnProperty('urls') &&\n              server.hasOwnProperty('url')) {\n            utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n            server = JSON.parse(JSON.stringify(server));\n            server.urls = server.url;\n            delete server.url;\n            newIceServers.push(server);\n          } else {\n            newIceServers.push(pcConfig.iceServers[i]);\n          }\n        }\n        pcConfig.iceServers = newIceServers;\n      }\n      return new OrigPeerConnection(pcConfig, pcConstraints);\n    };\n    window.RTCPeerConnection.prototype = OrigPeerConnection.prototype;\n    // wrap static methods. Currently just generateCertificate.\n    if ('generateCertificate' in window.RTCPeerConnection) {\n      Object.defineProperty(window.RTCPeerConnection, 'generateCertificate', {\n        get: function() {\n          return OrigPeerConnection.generateCertificate;\n        }\n      });\n    }\n  },\n  shimTrackEventTransceiver: function(window) {\n    // Add event.transceiver member over deprecated event.receiver\n    if (typeof window === 'object' && window.RTCPeerConnection &&\n        ('receiver' in window.RTCTrackEvent.prototype) &&\n        // can't check 'transceiver' in window.RTCTrackEvent.prototype, as it is\n        // defined for some reason even when window.RTCTransceiver is not.\n        !window.RTCTransceiver) {\n      Object.defineProperty(window.RTCTrackEvent.prototype, 'transceiver', {\n        get: function() {\n          return {receiver: this.receiver};\n        }\n      });\n    }\n  },\n\n  shimCreateOfferLegacy: function(window) {\n    var origCreateOffer = window.RTCPeerConnection.prototype.createOffer;\n    window.RTCPeerConnection.prototype.createOffer = function(offerOptions) {\n      var pc = this;\n      if (offerOptions) {\n        var audioTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'audio';\n        });\n        if (offerOptions.offerToReceiveAudio === false && audioTransceiver) {\n          if (audioTransceiver.direction === 'sendrecv') {\n            audioTransceiver.setDirection('sendonly');\n          } else if (audioTransceiver.direction === 'recvonly') {\n            audioTransceiver.setDirection('inactive');\n          }\n        } else if (offerOptions.offerToReceiveAudio === true &&\n            !audioTransceiver) {\n          pc.addTransceiver('audio');\n        }\n\n        var videoTransceiver = pc.getTransceivers().find(function(transceiver) {\n          return transceiver.sender.track &&\n              transceiver.sender.track.kind === 'video';\n        });\n        if (offerOptions.offerToReceiveVideo === false && videoTransceiver) {\n          if (videoTransceiver.direction === 'sendrecv') {\n            videoTransceiver.setDirection('sendonly');\n          } else if (videoTransceiver.direction === 'recvonly') {\n            videoTransceiver.setDirection('inactive');\n          }\n        } else if (offerOptions.offerToReceiveVideo === true &&\n            !videoTransceiver) {\n          pc.addTransceiver('video');\n        }\n      }\n      return origCreateOffer.apply(pc, arguments);\n    };\n  }\n};\n\n// Expose public methods.\nmodule.exports = {\n  shimCallbacksAPI: safariShim.shimCallbacksAPI,\n  shimLocalStreamsAPI: safariShim.shimLocalStreamsAPI,\n  shimRemoteStreamsAPI: safariShim.shimRemoteStreamsAPI,\n  shimGetUserMedia: safariShim.shimGetUserMedia,\n  shimRTCIceServerUrls: safariShim.shimRTCIceServerUrls,\n  shimTrackEventTransceiver: safariShim.shimTrackEventTransceiver,\n  shimCreateOfferLegacy: safariShim.shimCreateOfferLegacy\n  // TODO\n  // shimPeerConnection: safariShim.shimPeerConnection\n};\n\n},{\"../utils\":13}],13:[function(require,module,exports){\n/*\n *  Copyright (c) 2016 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n /* eslint-env node */\n'use strict';\n\nvar logDisabled_ = true;\nvar deprecationWarnings_ = true;\n\n// Utility methods.\nvar utils = {\n  disableLog: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    logDisabled_ = bool;\n    return (bool) ? 'adapter.js logging disabled' :\n        'adapter.js logging enabled';\n  },\n\n  /**\n   * Disable or enable deprecation warnings\n   * @param {!boolean} bool set to true to disable warnings.\n   */\n  disableWarnings: function(bool) {\n    if (typeof bool !== 'boolean') {\n      return new Error('Argument type: ' + typeof bool +\n          '. Please use a boolean.');\n    }\n    deprecationWarnings_ = !bool;\n    return 'adapter.js deprecation warnings ' + (bool ? 'disabled' : 'enabled');\n  },\n\n  log: function() {\n    if (typeof window === 'object') {\n      if (logDisabled_) {\n        return;\n      }\n      if (typeof console !== 'undefined' && typeof console.log === 'function') {\n        console.log.apply(console, arguments);\n      }\n    }\n  },\n\n  /**\n   * Shows a deprecation warning suggesting the modern and spec-compatible API.\n   */\n  deprecated: function(oldMethod, newMethod) {\n    if (!deprecationWarnings_) {\n      return;\n    }\n    console.warn(oldMethod + ' is deprecated, please use ' + newMethod +\n        ' instead.');\n  },\n\n  /**\n   * Extract browser version out of the provided user agent string.\n   *\n   * @param {!string} uastring userAgent string.\n   * @param {!string} expr Regular expression used as match criteria.\n   * @param {!number} pos position in the version string to be returned.\n   * @return {!number} browser version.\n   */\n  extractVersion: function(uastring, expr, pos) {\n    var match = uastring.match(expr);\n    return match && match.length >= pos && parseInt(match[pos], 10);\n  },\n\n  /**\n   * Browser detector.\n   *\n   * @return {object} result containing browser and version\n   *     properties.\n   */\n  detectBrowser: function(window) {\n    var navigator = window && window.navigator;\n\n    // Returned result object.\n    var result = {};\n    result.browser = null;\n    result.version = null;\n\n    // Fail early if it's not a browser\n    if (typeof window === 'undefined' || !window.navigator) {\n      result.browser = 'Not a browser.';\n      return result;\n    }\n\n    // Firefox.\n    if (navigator.mozGetUserMedia) {\n      result.browser = 'firefox';\n      result.version = this.extractVersion(navigator.userAgent,\n          /Firefox\\/(\\d+)\\./, 1);\n    } else if (navigator.webkitGetUserMedia) {\n      // Chrome, Chromium, Webview, Opera, all use the chrome shim for now\n      if (window.webkitRTCPeerConnection) {\n        result.browser = 'chrome';\n        result.version = this.extractVersion(navigator.userAgent,\n          /Chrom(e|ium)\\/(\\d+)\\./, 2);\n      } else { // Safari (in an unpublished version) or unknown webkit-based.\n        if (navigator.userAgent.match(/Version\\/(\\d+).(\\d+)/)) {\n          result.browser = 'safari';\n          result.version = this.extractVersion(navigator.userAgent,\n            /AppleWebKit\\/(\\d+)\\./, 1);\n        } else { // unknown webkit-based browser.\n          result.browser = 'Unsupported webkit-based browser ' +\n              'with GUM support but no WebRTC support.';\n          return result;\n        }\n      }\n    } else if (navigator.mediaDevices &&\n        navigator.userAgent.match(/Edge\\/(\\d+).(\\d+)$/)) { // Edge.\n      result.browser = 'edge';\n      result.version = this.extractVersion(navigator.userAgent,\n          /Edge\\/(\\d+).(\\d+)$/, 2);\n    } else if (navigator.mediaDevices &&\n        navigator.userAgent.match(/AppleWebKit\\/(\\d+)\\./)) {\n        // Safari, with webkitGetUserMedia removed.\n      result.browser = 'safari';\n      result.version = this.extractVersion(navigator.userAgent,\n          /AppleWebKit\\/(\\d+)\\./, 1);\n    } else { // Default fallthrough: not supported.\n      result.browser = 'Not a supported browser.';\n      return result;\n    }\n\n    return result;\n  },\n\n};\n\n// Export.\nmodule.exports = {\n  log: utils.log,\n  deprecated: utils.deprecated,\n  disableLog: utils.disableLog,\n  disableWarnings: utils.disableWarnings,\n  extractVersion: utils.extractVersion,\n  shimCreateObjectURL: utils.shimCreateObjectURL,\n  detectBrowser: utils.detectBrowser.bind(utils)\n};\n\n},{}]},{},[3])(3)\n});\n\n\n// WEBPACK FOOTER //\n// ./node_modules/webrtc-adapter/out/adapter.js","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || Function(\"return this\")() || (1,eval)(\"this\");\n} catch(e) {\n\t// This works if the window reference is available\n\tif(typeof window === \"object\")\n\t\tg = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n\n\n\n// WEBPACK FOOTER //\n// (webpack)/buildin/global.js"],"sourceRoot":""}